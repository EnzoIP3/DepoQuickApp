import{Xb as d,Yb as m,a as s,b as n,cb as c,e as u,k as l,n as a,q as i,zb as p}from"./chunk-2GDBKQSI.js";var g=class o extends d{constructor(e,t){super(m.apiUrl,"auth",e,t)}login(e){return this.post(e)}static \u0275fac=function(t){return new(t||o)(i(c),i(p))};static \u0275prov=a({token:o,factory:o.\u0275fac,providedIn:"root"})};var L=class o{constructor(e){this._repository=e}_userLogged$=new u(null);_getUserLoggedFromLocalStorage(){let e=this._getLocalStorageData();return e?.token?e:null}_getLocalStorageData(){let e=localStorage.getItem("user");if(e)try{return JSON.parse(e)}catch{return null}return null}_setLocalStorageData(e){localStorage.setItem("user",JSON.stringify(e))}get userLogged(){let e=this._getUserLoggedFromLocalStorage();return!this._userLogged$.value&&e&&this._userLogged$.next(e),this._userLogged$.asObservable()}login(e){return this._repository.login(e).pipe(l(t=>{let r=this._buildUserLogged(t);this._setLocalStorageData(r),this._userLogged$.next(r)}))}_buildUserLogged(e,t){return t??=Object.keys(e.roles)[0],{userId:e.userId,token:e.token,roles:e.roles,currentRole:Object.keys(e.roles)[0]}}logout(){localStorage.clear(),this._userLogged$.next(null)}setRoles(e){let t=this._userLogged$.value;if(t){let r=n(s({},t),{roles:s(s({},t.roles),e)});this._setLocalStorageData(r),this._userLogged$.next(r)}}switchCurrentRole(e){let t=this._userLogged$.value;if(t){let r=n(s({},t),{currentRole:e});this._setLocalStorageData(r),this._userLogged$.next(r)}}static \u0275fac=function(t){return new(t||o)(i(g))};static \u0275prov=a({token:o,factory:o.\u0275fac,providedIn:"root"})};export{L as a};
