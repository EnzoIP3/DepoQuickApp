import{a as U}from"./chunk-VUDT63JA.js";import{a as Q}from"./chunk-CPWWQRJC.js";import{b as H,c as L,e as R}from"./chunk-QQ367BQP.js";import"./chunk-FBSXW3BF.js";import{a as $}from"./chunk-OQ6TPHBS.js";import"./chunk-FFVHMX5G.js";import{a as A}from"./chunk-U64QIMIT.js";import"./chunk-XPYDWX67.js";import"./chunk-3VIG4VHP.js";import{Aa as M,Cb as P,K as s,L as b,T as _,V as n,Xb as G,Ya as j,Yb as z,Za as k,aa as c,ab as T,ba as p,ca as l,cb as q,da as g,ea as h,ha as S,ia as D,n as y,o as C,q as u,s as f,t as N,zb as E}from"./chunk-2GDBKQSI.js";var F=class i{size;height;static \u0275fac=function(t){return new(t||i)};static \u0275cmp=f({type:i,selectors:[["app-skeleton"]],inputs:{size:"size",height:"height"},standalone:!0,features:[M],decls:1,vars:2,consts:[[3,"size","height"]],template:function(t,o){if(t&1&&l(0,"p-skeleton",0),t&2){let a;n("size",o.size)("height",(a=o.height)!==null&&a!==void 0?a:"")}},dependencies:[L,H],encapsulation:2})};var w=class i extends G{constructor(e,t){super(z.apiUrl,"notifications",e,t)}getNotifications(e){return this.get({queries:e})}static \u0275fac=function(t){return new(t||i)(u(q),u(E))};static \u0275prov=y({token:i,factory:i.\u0275fac,providedIn:"root"})};var I=class i{constructor(e){this._repository=e}getNotifications(e){return this._repository.getNotifications(e)}static \u0275fac=function(t){return new(t||i)(u(w))};static \u0275prov=y({token:i,factory:i.\u0275fac,providedIn:"root"})};function K(i,e){if(i&1&&(g(0),l(1,"app-message",6),h()),i&2){let t=e.$implicit,o=D(2);s(),n("text",t.event)("icon",t.read?"pi pi-eye":"pi pi-sparkles")("detail",o.getNotificationDetail(t))("closable",!1)}}function W(i,e){if(i&1&&(g(0),_(1,K,2,4,"ng-container",5),h()),i&2){let t=D();s(),n("ngForOf",t.notifications)}}function X(i,e){i&1&&(g(0),c(1,"div",7),l(2,"app-skeleton",8),p(),h())}function Z(i,e){if(i&1&&(g(0),_(1,X,3,0,"ng-container",5),h()),i&2){let t=D();s(),n("ngForOf",t.loadingArray)}}var d=class i{constructor(e,t,o){this._notificationsService=e;this._messagesService=t;this._deviceTypesService=o}_notificationsSubscription=null;notifications=[];loading=!0;loadingArray=Array(5);filters={read:!1};devices=[];dates=[];readStates=[{label:"Read",value:!0},{label:"Unread",value:!1}];ngOnInit(){this.fetchNotifications(),this.fetchDeviceTypes()}fetchNotifications(){this.loading=!0;let e=this.buildQueryParams();this.unsubscribeNotifications(),this._notificationsSubscription=this._notificationsService.getNotifications(e).subscribe({next:t=>{this.loading=!1,this.notifications=t.notifications,this.dates.length===0&&this.initializeFilterOptions(t.notifications)},error:t=>this.handleError(t)})}fetchDeviceTypes(){this._deviceTypesService.getDeviceTypes().subscribe({next:e=>{this.devices=e.deviceTypes.map(t=>({label:t,value:t}))},error:e=>{this._messagesService.add({severity:"error",summary:"Error",detail:`Failed to load device types: ${e.message}`})}})}initializeFilterOptions(e){this.dates=this.getUniqueOptions(e,t=>this.formatDate(t.dateCreated),t=>this.formatDate(t.dateCreated))}getUniqueOptions(e,t,o){let a=new Map;return e.forEach(r=>{let v=t(r);a.has(v)||a.set(v,o(r))}),Array.from(a,([r,v])=>({label:v,value:r}))}buildQueryParams(){let e={};return this.filters.device&&(e.device=this.filters.device),this.filters.dateCreated&&(e.dateCreated=this.filters.dateCreated),typeof this.filters.read=="boolean"&&(e.read=this.filters.read),e}formatDate(e){let t=new Date(e),o=String(t.getDate()).padStart(2,"0"),a=String(t.getMonth()+1).padStart(2,"0"),r=t.getFullYear();return`${o}-${a}-${r}`}handleError(e){this.loading=!1,this._messagesService.add({severity:"error",summary:"Error",detail:e.message})}onDeviceFilterChange(e){this.filters.device=e,this.fetchNotifications()}onDateFilterChange(e){this.filters.dateCreated=e,this.fetchNotifications()}onReadFilterChange(e){this.filters.read=e===null?void 0:e,this.fetchNotifications()}unsubscribeNotifications(){this._notificationsSubscription?.unsubscribe()}getNotificationDetail(e){return`Generated by ${e.device.name} at ${e.dateCreated}`}ngOnDestroy(){this.unsubscribeNotifications()}static \u0275fac=function(t){return new(t||i)(b(I),b(A),b(Q))};static \u0275cmp=f({type:i,selectors:[["app-notification-messages"]],standalone:!0,features:[M],decls:6,vars:14,consts:[[1,"flex","md:flex-row","flex-column","gap-1"],["placeholder","Filter by Device",3,"change","options","showClear","appendTo"],["placeholder","Filter by Date Created",3,"change","options","showClear","appendTo"],["placeholder","Filter by Read Status",3,"change","options","showClear","optionLabel","optionValue","value","appendTo"],[4,"ngIf"],[4,"ngFor","ngForOf"],["severity","info",3,"text","icon","detail","closable"],[1,"mt-2"],["height","3rem"]],template:function(t,o){t&1&&(c(0,"div",0)(1,"app-dropdown",1),S("change",function(r){return o.onDeviceFilterChange(r)}),p(),c(2,"app-dropdown",2),S("change",function(r){return o.onDateFilterChange(r)}),p(),c(3,"app-dropdown",3),S("change",function(r){return o.onReadFilterChange(r)}),p()(),_(4,W,2,1,"ng-container",4)(5,Z,2,1,"ng-container",4)),t&2&&(s(),n("options",o.devices)("showClear",!0)("appendTo",null),s(),n("options",o.dates)("showClear",!0)("appendTo",null),s(),n("options",o.readStates)("showClear",!0)("optionLabel","label")("optionValue","value")("value",!1)("appendTo",null),s(),n("ngIf",!o.loading),s(),n("ngIf",o.loading))},dependencies:[T,j,k,$,U,F],encapsulation:2})};var x=class i{static \u0275fac=function(t){return new(t||i)};static \u0275cmp=f({type:i,selectors:[["app-notifications-page"]],decls:3,vars:1,consts:[[1,"mt-2"],["title","Notifications","icon","pi pi-bell",3,"toggleable"]],template:function(t,o){t&1&&(c(0,"div",0)(1,"app-panel",1),l(2,"app-notification-messages"),p()()),t&2&&(s(),n("toggleable",!1))},dependencies:[d,R]})};var te=[{path:"",component:x}],O=class i{static \u0275fac=function(t){return new(t||i)};static \u0275mod=N({type:i});static \u0275inj=C({imports:[P.forChild(te),P]})};var Y=class i{static \u0275fac=function(t){return new(t||i)};static \u0275mod=N({type:i});static \u0275inj=C({imports:[T,O,d,R]})};export{Y as NotificationsModule};
