import{c as Ti,d as Bi}from"./chunk-CV257ZC2.js";import{a as Vi}from"./chunk-CPWWQRJC.js";import{a as Mi,b as z}from"./chunk-OMSTUI2X.js";import{a as w,b as A,c as T,d as be}from"./chunk-SVEYEHT4.js";import{f as Oi}from"./chunk-MQS2OHBC.js";import"./chunk-TDDMEX7Y.js";import{e as B}from"./chunk-QQ367BQP.js";import{a as me}from"./chunk-L6TZS5FK.js";import{e as pe}from"./chunk-6ZQIWECF.js";import{a as le}from"./chunk-KW7F2QVL.js";import{a as E}from"./chunk-SLUHDBGA.js";import"./chunk-P47V3DL4.js";import{a as y,h as ki,i as wi}from"./chunk-U64QIMIT.js";import"./chunk-XPYDWX67.js";import{a as ze,b as Fi,d as b,e as Di,f as ce,g as de,h as Ri,k as ue,l as fe,m as N,o as ve}from"./chunk-3VIG4VHP.js";import{$a as gi,Aa as P,Ab as ae,B as ti,Ba as re,C as Q,Ca as ui,Cb as We,Db as Ke,Ea as $e,Fa as fi,K as n,L as a,Lb as Ci,Oa as se,Ob as yi,Pb as _i,Qa as $,Ra as vi,S as oi,T as C,U as M,V as s,Xa as W,Xb as F,Y as ri,Ya as bi,Yb as D,Z as Ne,Za as K,Zb as Si,_a as hi,_b as Ii,a as j,aa as m,ab as k,b as ei,ba as p,ca as d,cb as I,da as Ae,ea as qe,ga as Ge,ha as h,ia as _,la as Le,m as ii,ma as si,n as f,na as ni,o as G,oa as ai,pa as Ue,q as c,qa as He,ra as Qe,s as v,sa as q,t as L,ta as mi,ua as oe,wa as pi,x as U,xa as li,xb as ne,y as H,ya as ci,za as di,zb as g}from"./chunk-2GDBKQSI.js";var X=class t{constructor(i,e,o,r){this._router=i;this._userService=e;this._messagesService=o;this._authService=r}columns=[{field:"logo",header:"Logo"},{field:"name",header:"Business Name"},{field:"ownerName",header:"Owner Name"},{field:"ownerEmail",header:"Owner Email"},{field:"rut",header:"RUT"}];businesses=[];pagination={};loading=!0;_businessesSubscription=null;_authSubscription=null;_userId=null;onPageChange(i){this.loading=!0,this._subscribeToBusinesses(j({},i))}ngOnInit(){this._getUserId()}_getUserId(){this._authSubscription=this._authService.userLogged.subscribe({next:i=>{i?(this._userId=i.userId,this._subscribeToBusinesses()):this._messagesService.add({severity:"error",summary:"Error",detail:"No user is logged in"})},error:i=>{this._messagesService.add({severity:"error",summary:"Error",detail:i.message})}})}ngOnDestroy(){this._businessesSubscription?.unsubscribe(),this._authSubscription?.unsubscribe()}onRowClick(i){this._router.navigate(["/businesses",i.rut])}_subscribeToBusinesses(i){this._userId&&(this._businessesSubscription=this._userService.getBusinesses(i?j({},i):{},this._userId).subscribe({next:e=>{this.businesses=e.businesses,this.pagination=e.pagination,this.loading=!1},error:e=>{this.loading=!1,this._messagesService.add({severity:"error",summary:"Error",detail:e.message})}}))}static \u0275fac=function(e){return new(e||t)(a(g),a(le),a(y),a(me))};static \u0275cmp=v({type:t,selectors:[["app-businesses-table"]],standalone:!0,features:[P],decls:2,vars:4,consts:[[1,"mt-2"],[3,"pageChange","rowClick","businesses","columns","loading","pagination"]],template:function(e,o){e&1&&(m(0,"div",0)(1,"app-base-businesses-table",1),h("pageChange",function(l){return o.onPageChange(l)})("rowClick",function(l){return o.onRowClick(l)}),p()()),e&2&&(n(),s("businesses",o.businesses)("columns",o.columns)("loading",o.loading)("pagination",o.pagination))},dependencies:[Mi],encapsulation:2})};var he=class t{static \u0275fac=function(e){return new(e||t)};static \u0275cmp=v({type:t,selectors:[["app-businesses-page"]],decls:5,vars:0,consts:[[1,"mt-2"],["icon","pi-building","title","Businesses"],[1,"mt-2","flex","justify-content-end"],["icon","pi pi-plus","label","Create business","routerLink","/businesses/new"]],template:function(e,o){e&1&&(m(0,"div",0)(1,"app-panel",1),d(2,"app-businesses-table"),p(),m(3,"div",2),d(4,"app-button",3),p()())},dependencies:[ae,B,X,E],encapsulation:2})};var ge=class t extends F{constructor(i,e){super(D.apiUrl,"device_validators",i,e)}getDeviceValidators(){return this.get()}static \u0275fac=function(e){return new(e||t)(c(I),c(g))};static \u0275prov=f({token:t,factory:t.\u0275fac,providedIn:"root"})};var J=class t{constructor(i){this._repository=i}getDeviceValidators(){return this._repository.getDeviceValidators()}static \u0275fac=function(e){return new(e||t)(c(ge))};static \u0275prov=f({token:t,factory:t.\u0275fac,providedIn:"root"})};var Qi=()=>({width:"100%"});function $i(t,i){if(t&1&&(m(0,"label",3),q(1),p()),t&2){let e=_();s("for",e.name),n(),mi(e.label)}}var R=class t{form;name;label;placeholder;options=[];onChange=new Q;get error(){let i=this.form.get(this.name);return!!(i&&i.touched&&i.errors)}get errorClass(){return{"ng-invalid":this.error,"ng-dirty":this.error}}static \u0275fac=function(e){return new(e||t)};static \u0275cmp=v({type:t,selectors:[["app-form-dropdown"]],inputs:{form:"form",name:"name",label:"label",placeholder:"placeholder",options:"options"},outputs:{onChange:"onChange"},standalone:!0,features:[P],decls:3,vars:10,consts:[[1,"field",3,"formGroup"],[3,"for",4,"ngIf"],[1,"w-full",3,"onChange","options","formControlName","placeholder","ngClass","showClear"],[3,"for"]],template:function(e,o){e&1&&(m(0,"div",0),C(1,$i,2,2,"label",1),m(2,"p-dropdown",2),h("onChange",function(l){return o.onChange.emit(l)}),p()()),e&2&&(s("formGroup",o.form),n(),s("ngIf",o.label),n(),ri(re(9,Qi)),s("options",o.options)("formControlName",o.name)("placeholder",o.placeholder)("ngClass",o.errorClass)("showClear",!0))},dependencies:[k,W,K,wi,ki,ve,ce,de,ue,fe],encapsulation:2})};var _e=class t{constructor(i,e,o,r,l){this._formBuilder=i;this._router=e;this._messagesService=o;this._businessesService=r;this._validatorService=l}formFields={name:{required:{message:"Name is required"}},logo:{required:{message:"Logo is required"},pattern:{message:"Logo must be a valid image URL"}},rut:{required:{message:"Rut is required"},pattern:{message:"Rut must follow the correct format (e.g., 12.345.678-9)"}}};_businessesSubscription=null;_validatorsSubscription=null;businessForm;status={loading:!1,error:null};validatorOptions=[];ngOnInit(){this.businessForm=this._formBuilder.group({name:["",[b.required,b.maxLength(100)]],logo:["",[b.required,b.pattern(/^(http|https):\/\/[^ "]+$/)]],rut:["",[b.required,b.pattern(/^\d{1,2}\.\d{3}\.\d{3}-[\dKk]{1}$/)]],validator:["",[]]}),this._validatorsSubscription=this._validatorService.getDeviceValidators().subscribe({next:i=>{this.validatorOptions=i.validators.map(e=>({label:e,value:e}))},error:i=>{this._messagesService.add({severity:"error",summary:"Error",detail:i.message})}})}onSubmit(){this.status.loading=!0,this.status.error=null,console.log(this.businessForm.value),this.businessForm.valid&&(this._businessesSubscription=this._businessesService.postBusiness(this.businessForm.value).subscribe({next:i=>{this.status.loading=!1,this._messagesService.add({severity:"success",summary:"Business Added",detail:`The business ${i.rut} has been added successfully.`}),this._router.navigate(["/businesses"])},error:i=>{this.status.loading=!1,this.status.error=i,this._messagesService.add({severity:"error",summary:"Error",detail:i.message})}}))}ngOnDestroy(){this._businessesSubscription?.unsubscribe(),this._validatorsSubscription?.unsubscribe()}static \u0275fac=function(e){return new(e||t)(a(N),a(g),a(y),a(z),a(J))};static \u0275cmp=v({type:t,selectors:[["app-add-business-form"]],decls:8,vars:11,consts:[[1,"centered-content"],["title","Register a new business","icon","pi-building",1,"mb-4","text-primary-600","text-center"],[3,"onSubmit","form"],["type","text","label","Business Name","placeholder","Enter Business Name","name","name","iconClass","pi pi-briefcase",3,"form","formField"],["type","text","label","Logo URL","placeholder","Enter Logo URL","name","logo","iconClass","pi pi-image",3,"form","formField"],["type","text","label","Rut","placeholder","Enter Rut","name","rut","iconClass","pi pi-id-card",3,"form","formField"],["name","validator","label","Validator","placeholder","Select Validator",3,"form","options"],["title","Register Business","color","primary",3,"loading","disabled"]],template:function(e,o){e&1&&(m(0,"div",0),d(1,"app-icon-title",1),m(2,"app-form",2),h("onSubmit",function(){return o.onSubmit()}),d(3,"app-form-input",3)(4,"app-form-input",4)(5,"app-form-input",5)(6,"app-form-dropdown",6)(7,"app-form-button",7),p()()),e&2&&(n(2),s("form",o.businessForm),n(),s("form",o.businessForm)("formField",o.formFields.name),n(),s("form",o.businessForm)("formField",o.formFields.logo),n(),s("form",o.businessForm)("formField",o.formFields.rut),n(),s("form",o.businessForm)("options",o.validatorOptions),n(),s("loading",o.status.loading)("disabled",!o.businessForm.valid))},dependencies:[be,w,A,T,R],encapsulation:2})};var Se=class t extends F{constructor(i,e){super(D.apiUrl,"sensors",i,e)}addDevice(i){return this.post(i)}static \u0275fac=function(e){return new(e||t)(c(I),c(g))};static \u0275prov=f({token:t,factory:t.\u0275fac,providedIn:"root"})};var Ie=class t{constructor(i){this._repository=i}addDevice(i){return this._repository.addDevice(i)}static \u0275fac=function(e){return new(e||t)(c(Se))};static \u0275prov=f({token:t,factory:t.\u0275fac,providedIn:"root"})};var Fe=class t extends F{constructor(i,e){super(D.apiUrl,"lamps",i,e)}addDevice(i){return this.post(i)}static \u0275fac=function(e){return new(e||t)(c(I),c(g))};static \u0275prov=f({token:t,factory:t.\u0275fac,providedIn:"root"})};var De=class t{constructor(i){this._repository=i}addDevice(i){return this._repository.addDevice(i)}static \u0275fac=function(e){return new(e||t)(c(Fe))};static \u0275prov=f({token:t,factory:t.\u0275fac,providedIn:"root"})};var Re=class t extends F{constructor(i,e){super(D.apiUrl,"motion_sensors",i,e)}addDevice(i){return this.post(i)}static \u0275fac=function(e){return new(e||t)(c(I),c(g))};static \u0275prov=f({token:t,factory:t.\u0275fac,providedIn:"root"})};var ke=class t{constructor(i){this._repository=i}addDevice(i){return this._repository.addDevice(i)}static \u0275fac=function(e){return new(e||t)(c(Re))};static \u0275prov=f({token:t,factory:t.\u0275fac,providedIn:"root"})};var et=["input"],it=(t,i,e,o)=>({"p-checkbox p-component":!0,"p-checkbox-checked":t,"p-checkbox-disabled":i,"p-checkbox-focused":e,"p-variant-filled":o}),tt=(t,i,e)=>({"p-highlight":t,"p-disabled":i,"p-focus":e}),ot=(t,i,e)=>({"p-checkbox-label":!0,"p-checkbox-label-active":t,"p-disabled":i,"p-checkbox-label-focus":e});function rt(t,i){if(t&1&&d(0,"span",10),t&2){let e=_(3);s("ngClass",e.checkboxIcon),M("data-pc-section","icon")}}function st(t,i){t&1&&d(0,"CheckIcon",11),t&2&&(s("styleClass","p-checkbox-icon"),M("data-pc-section","icon"))}function nt(t,i){if(t&1&&(Ae(0),C(1,rt,1,2,"span",8)(2,st,1,2,"CheckIcon",9),qe()),t&2){let e=_(2);n(),s("ngIf",e.checkboxIcon),n(),s("ngIf",!e.checkboxIcon)}}function at(t,i){}function mt(t,i){t&1&&C(0,at,0,0,"ng-template")}function pt(t,i){if(t&1&&(m(0,"span",12),C(1,mt,1,0,null,13),p()),t&2){let e=_(2);M("data-pc-section","icon"),n(),s("ngTemplateOutlet",e.checkboxIconTemplate)}}function lt(t,i){if(t&1&&(Ae(0),C(1,nt,3,2,"ng-container",5)(2,pt,2,2,"span",7),qe()),t&2){let e=_();n(),s("ngIf",!e.checkboxIconTemplate),n(),s("ngIf",e.checkboxIconTemplate)}}function ct(t,i){if(t&1){let e=Ge();m(0,"label",14),h("click",function(r){U(e);let l=_(),S=Qe(3);return H(l.onClick(r,S,!0))}),q(1),p()}if(t&2){let e=_();Ne(e.labelStyleClass),s("ngClass",$e(6,ot,e.checked(),e.disabled,e.focused)),M("for",e.inputId)("data-pc-section","label"),n(),oe(" ",e.label,"")}}var dt={provide:Fi,useExisting:ii(()=>Ze),multi:!0},Ze=(()=>{class t{cd;injector;config;value;name;disabled;binary;label;ariaLabelledBy;ariaLabel;tabindex;inputId;style;styleClass;labelStyleClass;formControl;checkboxIcon;readonly;required;autofocus;trueValue=!0;falseValue=!1;variant="outlined";onChange=new Q;onFocus=new Q;onBlur=new Q;inputViewChild;templates;checkboxIconTemplate;model;onModelChange=()=>{};onModelTouched=()=>{};focused=!1;constructor(e,o,r){this.cd=e,this.injector=o,this.config=r}ngAfterContentInit(){this.templates.forEach(e=>{switch(e.getType()){case"icon":this.checkboxIconTemplate=e.template;break}})}onClick(e,o,r){e.preventDefault(),!(this.disabled||this.readonly)&&(this.updateModel(e),r&&o.focus())}updateModel(e){let o,r=this.injector.get(Di,null,{optional:!0,self:!0}),l=r&&!this.formControl?r.value:this.model;this.binary?(o=this.checked()?this.falseValue:this.trueValue,this.model=o,this.onModelChange(o)):(this.checked()?o=l.filter(S=>!Ke.equals(S,this.value)):o=l?[...l,this.value]:[this.value],this.onModelChange(o),this.model=o,this.formControl&&this.formControl.setValue(o)),this.onChange.emit({checked:o,originalEvent:e})}handleChange(e){this.readonly||this.updateModel(e)}onInputFocus(e){this.focused=!0,this.onFocus.emit(e)}onInputBlur(e){this.focused=!1,this.onBlur.emit(e),this.onModelTouched()}focus(){this.inputViewChild.nativeElement.focus()}writeValue(e){this.model=e,this.cd.markForCheck()}registerOnChange(e){this.onModelChange=e}registerOnTouched(e){this.onModelTouched=e}setDisabledState(e){setTimeout(()=>{this.disabled=e,this.cd.markForCheck()})}checked(){return this.binary?this.model===this.trueValue:Ke.contains(this.value,this.model)}static \u0275fac=function(o){return new(o||t)(a(se),a(ti),a(Ci))};static \u0275cmp=v({type:t,selectors:[["p-checkbox"]],contentQueries:function(o,r,l){if(o&1&&ni(l,yi,4),o&2){let S;Ue(S=He())&&(r.templates=S)}},viewQuery:function(o,r){if(o&1&&ai(et,5),o&2){let l;Ue(l=He())&&(r.inputViewChild=l.first)}},hostAttrs:[1,"p-element"],inputs:{value:"value",name:"name",disabled:[2,"disabled","disabled",$],binary:[2,"binary","binary",$],label:"label",ariaLabelledBy:"ariaLabelledBy",ariaLabel:"ariaLabel",tabindex:[2,"tabindex","tabindex",vi],inputId:"inputId",style:"style",styleClass:"styleClass",labelStyleClass:"labelStyleClass",formControl:"formControl",checkboxIcon:"checkboxIcon",readonly:[2,"readonly","readonly",$],required:[2,"required","required",$],autofocus:[2,"autofocus","autofocus",$],trueValue:"trueValue",falseValue:"falseValue",variant:"variant"},outputs:{onChange:"onChange",onFocus:"onFocus",onBlur:"onBlur"},features:[di([dt]),oi],decls:7,vars:37,consts:[["input",""],[3,"ngStyle","ngClass"],[1,"p-hidden-accessible"],["type","checkbox","pAutoFocus","",3,"change","focus","blur","value","checked","disabled","readonly","autofocus"],[1,"p-checkbox-box",3,"click","ngClass"],[4,"ngIf"],[3,"class","ngClass","click",4,"ngIf"],["class","p-checkbox-icon",4,"ngIf"],["class","p-checkbox-icon",3,"ngClass",4,"ngIf"],[3,"styleClass",4,"ngIf"],[1,"p-checkbox-icon",3,"ngClass"],[3,"styleClass"],[1,"p-checkbox-icon"],[4,"ngTemplateOutlet"],[3,"click","ngClass"]],template:function(o,r){if(o&1){let l=Ge();m(0,"div",1)(1,"div",2)(2,"input",3,0),h("change",function(x){return U(l),H(r.handleChange(x))})("focus",function(x){return U(l),H(r.onInputFocus(x))})("blur",function(x){return U(l),H(r.onInputBlur(x))}),p()(),m(4,"div",4),h("click",function(x){U(l);let qi=Qe(3);return H(r.onClick(x,qi,!0))}),C(5,lt,3,2,"ng-container",5),p()(),C(6,ct,2,10,"label",6)}o&2&&(Ne(r.styleClass),s("ngStyle",r.style)("ngClass",fi(28,it,r.checked(),r.disabled,r.focused,r.variant==="filled"||r.config.inputStyle()==="filled")),M("data-pc-name","checkbox")("data-pc-section","root"),n(),M("data-pc-section","hiddenInputWrapper")("data-p-hidden-accessible",!0),n(),s("value",r.value)("checked",r.checked())("disabled",r.disabled)("readonly",r.readonly)("autofocus",r.autofocus),M("id",r.inputId)("name",r.name)("tabindex",r.tabindex)("required",r.required)("aria-labelledby",r.ariaLabelledBy)("aria-label",r.ariaLabel)("aria-checked",r.checked())("data-pc-section","hiddenInput"),n(2),s("ngClass",$e(33,tt,r.checked(),r.disabled,r.focused)),M("data-p-highlight",r.checked())("data-p-disabled",r.disabled)("data-p-focused",r.focused)("data-pc-section","input"),n(),s("ngIf",r.checked()),n(),s("ngIf",r.label))},dependencies:()=>[W,K,gi,hi,Si,ze],styles:[`@layer primeng{.p-checkbox{display:inline-flex;cursor:pointer;-webkit-user-select:none;user-select:none;vertical-align:bottom;position:relative}.p-checkbox-disabled{cursor:default!important;pointer-events:none}.p-checkbox-box{display:flex;justify-content:center;align-items:center}p-checkbox{display:inline-flex;vertical-align:bottom;align-items:center}.p-checkbox-label{line-height:1}}
`],encapsulation:2,changeDetection:0})}return t})(),Ni=(()=>{class t{static \u0275fac=function(o){return new(o||t)};static \u0275mod=L({type:t});static \u0275inj=G({imports:[k,Ii,ze,_i]})}return t})();var Z=class t{form;name;label;get error(){let i=this.form.get(this.name);return!!(i&&i.touched&&i.errors)}get errorClass(){return{"ng-invalid":this.error,"ng-dirty":this.error}}static \u0275fac=function(e){return new(e||t)};static \u0275cmp=v({type:t,selectors:[["app-form-checkbox"]],inputs:{form:"form",name:"name",label:"label"},standalone:!0,features:[P],decls:2,vars:5,consts:[[1,"field",3,"formGroup"],[3,"formControlName","label","ngClass","binary"]],template:function(e,o){e&1&&(m(0,"div",0),d(1,"p-checkbox",1),p()),e&2&&(s("formGroup",o.form),n(),s("formControlName",o.name)("label",o.label)("ngClass",o.errorClass)("binary",!0))},dependencies:[k,W,Ni,Ze,ve,ce,de,ue,fe],encapsulation:2})};function vt(t,i){if(t&1&&(m(0,"div"),d(1,"app-form-checkbox",9)(2,"app-form-checkbox",10)(3,"app-form-checkbox",11)(4,"app-form-checkbox",12),p()),t&2){let e=_();n(),s("form",e.deviceForm),n(),s("form",e.deviceForm),n(),s("form",e.deviceForm),n(),s("form",e.deviceForm)}}var we=class t{constructor(i,e,o,r,l,S,x){this._formBuilder=i;this._messagesService=e;this._cameraService=o;this._sensorService=r;this._lampService=l;this._motionSensorService=S;this._deviceTypesService=x}formFields={name:{required:{message:"Device name is required"}},modelNumber:{required:{message:"Model number is required"}},description:{required:{message:"Description is required"}},mainPhoto:{required:{message:"Main photo is required"},pattern:{message:"Main photo must be a valid image URL"}}};deviceForm;status={loading:!1,error:null};deviceTypes=[];_deviceSubscription=null;_deviceTypesSubscription=null;ngOnInit(){this._buildForm(),this._getDeviceTypes(),this._handleDeviceTypeChanges()}_handleDeviceTypeChanges(){this.deviceForm.get("type")?.valueChanges.subscribe(i=>{i==="Camera"?(this.deviceForm.get("motionDetection")?.setValidators(b.required),this.deviceForm.get("personDetection")?.setValidators(b.required)):(this.deviceForm.get("motionDetection")?.clearValidators(),this.deviceForm.get("personDetection")?.clearValidators()),this.deviceForm.get("motionDetection")?.updateValueAndValidity(),this.deviceForm.get("personDetection")?.updateValueAndValidity()})}_getDeviceTypes(){this._deviceTypesSubscription=this._deviceTypesService.getDeviceTypes().subscribe({next:i=>{this.deviceTypes=i.deviceTypes.map(e=>({label:e,value:e}))},error:i=>{this._messagesService.add({severity:"error",summary:"Error",detail:"Failed to load device types. "+i.message})}})}_buildForm(){this.deviceForm=this._formBuilder.group({name:["",[b.required,b.maxLength(100)]],modelNumber:["",[b.required,b.maxLength(50)]],description:["",[b.required,b.maxLength(250)]],mainPhoto:["",[b.required,b.pattern(/^(http|https):\/\/[^ "]+$/)]],secondaryPhotos:[],type:["",[b.required]],motionDetection:[!1,[]],personDetection:[!1,[]],isExterior:[!1,[]],isInterior:[!1,[]]})}_getServiceForType(i){switch(i){case"Camera":return this._cameraService;case"Sensor":return this._sensorService;case"MotionSensor":return this._motionSensorService;case"Lamp":return this._lampService;default:throw new Error("Invalid device type.")}}onSubmit(){if(this.status.loading=!0,this.status.error=null,this.deviceForm.valid){let i=this.deviceForm.get("type")?.value,e=this._getServiceForType(i),o=this._filterFormDataForDeviceType(i);this._deviceSubscription=e.addDevice(o).subscribe({next:r=>{this.status.loading=!1,this._messagesService.add({severity:"success",summary:`${i} Added`,detail:`The ${i.toLowerCase()} with ID: ${r.id} has been added successfully.`}),this.deviceForm.reset(),this.deviceForm.patchValue({motionDetection:!1,personDetection:!1,isExterior:!1,isInterior:!1})},error:r=>{this.status.loading=!1,this.status.error=r,this._messagesService.add({severity:"error",summary:"Error",detail:r.message})}})}else this.status.loading=!1,this._messagesService.add({severity:"error",summary:"Form Error",detail:"Please correct the form errors and try again."})}_filterFormDataForDeviceType(i){let e={name:this.deviceForm.get("name")?.value,modelNumber:this.deviceForm.get("modelNumber")?.value,description:this.deviceForm.get("description")?.value,mainPhoto:this.deviceForm.get("mainPhoto")?.value,secondaryPhotos:this.deviceForm.get("secondaryPhotos")?.value?this.deviceForm.get("secondaryPhotos")?.value.split(","):[]};switch(i){case"Camera":return ei(j({},e),{motionDetection:this.deviceForm.get("motionDetection")?.value,personDetection:this.deviceForm.get("personDetection")?.value,exterior:this.deviceForm.get("isExterior")?.value,interior:this.deviceForm.get("isInterior")?.value});case"Sensor":case"Lamp":case"Movement Sensor":default:return e}}ngOnDestroy(){this._deviceSubscription?.unsubscribe(),this._deviceTypesSubscription?.unsubscribe()}static \u0275fac=function(e){return new(e||t)(a(N),a(y),a(Ti),a(Ie),a(De),a(ke),a(Vi))};static \u0275cmp=v({type:t,selectors:[["app-add-device-form"]],decls:9,vars:15,consts:[[3,"onSubmit","form"],["type","text","label","Name","placeholder","Enter device name","name","name","iconClass","pi pi-lightbulb",3,"form","formField"],["type","text","label","Model Number","placeholder","Enter model number","name","modelNumber","iconClass","pi pi-calculator",3,"form","formField"],["type","text","label","Description","placeholder","Enter description","name","description","iconClass","pi pi-comment",3,"form","formField"],["type","text","label","Main Photo URL","placeholder","Enter main photo URL","name","mainPhoto","iconClass","pi pi-image",3,"form","formField"],["type","text","label","Secondary Photos URLs","placeholder","Enter secondary photo URLs (comma-separated)","name","secondaryPhotos","iconClass","pi pi-image",3,"form"],["label","Device Type","placeholder","Select device type","name","type",3,"form","options"],[4,"ngIf"],["title","Register Device","color","primary",3,"loading","disabled"],["label","Motion Detection","name","motionDetection",3,"form"],["label","Person Detection","name","personDetection",3,"form"],["label","Is this camera exterior?","name","isExterior",3,"form"],["label","Is this camera interior?","name","isInterior",3,"form"]],template:function(e,o){if(e&1&&(m(0,"app-form",0),h("onSubmit",function(){return o.onSubmit()}),d(1,"app-form-input",1)(2,"app-form-input",2)(3,"app-form-input",3)(4,"app-form-input",4)(5,"app-form-input",5)(6,"app-form-dropdown",6),C(7,vt,5,4,"div",7),d(8,"app-form-button",8),p()),e&2){let r;s("form",o.deviceForm),n(),s("form",o.deviceForm)("formField",o.formFields.name),n(),s("form",o.deviceForm)("formField",o.formFields.modelNumber),n(),s("form",o.deviceForm)("formField",o.formFields.description),n(),s("form",o.deviceForm)("formField",o.formFields.mainPhoto),n(),s("form",o.deviceForm),n(),s("form",o.deviceForm)("options",o.deviceTypes),n(),s("ngIf",((r=o.deviceForm.get("type"))==null?null:r.value)==="Camera"),n(),s("loading",o.status.loading)("disabled",!o.deviceForm.valid)}},dependencies:[K,w,A,T,R,Z],encapsulation:2})};var Te=class t extends F{constructor(i,e){super(D.apiUrl,"device_importers",i,e)}getImporters(){return this.get()}static \u0275fac=function(e){return new(e||t)(c(I),c(g))};static \u0275prov=f({token:t,factory:t.\u0275fac,providedIn:"root"})};var Be=class t{constructor(i){this._repository=i}getImporters(){return this._repository.getImporters()}static \u0275fac=function(e){return new(e||t)(c(Te))};static \u0275prov=f({token:t,factory:t.\u0275fac,providedIn:"root"})};var Oe=class t extends F{constructor(i,e){super(D.apiUrl,"device_import_files",i,e)}getImportFiles(){return this.get()}static \u0275fac=function(e){return new(e||t)(c(I),c(g))};static \u0275prov=f({token:t,factory:t.\u0275fac,providedIn:"root"})};var Ve=class t{constructor(i){this._repository=i}getImportFiles(){return this._repository.getImportFiles()}static \u0275fac=function(e){return new(e||t)(c(Oe))};static \u0275prov=f({token:t,factory:t.\u0275fac,providedIn:"root"})};var _t=()=>({message:"Parameter is required"}),St=t=>({required:t});function It(t,i){if(t&1&&(m(0,"div"),d(1,"app-form-input",11),p()),t&2){let e=i.$implicit,o=_();n(),Le("label",e),si("placeholder","Enter ",e,""),Le("name",e),s("form",o.parameters)("formField",ui(7,St,re(6,_t)))}}function Ft(t,i){if(t&1&&(m(0,"li",12),q(1),p()),t&2){let e=i.$implicit;n(),oe(" ",e.label," ")}}var Me=class t{constructor(i,e,o,r,l,S){this.fb=i;this._messagesService=e;this._deviceImportersService=o;this._deviceImportFilesService=r;this._deviceService=l;this.cdr=S;this.importDevicesForm=this.fb.group({importer:["",b.required],parameters:this.fb.group({})}),this.parameters=this.importDevicesForm.get("parameters")}businessId;selectedImporterParameters=[];importDevicesForm;parameters;importerOptions=[];fileOptions=[];showConfirmationDialog=!1;status={loading:!1,error:null};_importersSubscription=null;_filesSubscription=null;_devicesSubscription=null;ngOnInit(){this.status.loading=!0,this._importersSubscription=this._deviceImportersService.getImporters().subscribe({next:i=>{this.importerOptions=i.importers.map(e=>({label:e.name,value:e.name,parameters:e.parameters})),console.log(i),this.status.loading=!1},error:i=>{this.status.loading=!1,this.status.error=i,this._messagesService.add({severity:"error",summary:"Error loading importers",detail:i.message})}}),this._filesSubscription=this._deviceImportFilesService.getImportFiles().subscribe({next:i=>{this.fileOptions=i.importFiles.map(e=>({label:e,value:e}))},error:i=>{this.status.error=i,this._messagesService.add({severity:"error",summary:"Error loading files",detail:i.message})}})}onSubmit(){console.log(this.importDevicesForm.value),this.importDevicesForm.valid?this.showConfirmationDialog=!0:this._messagesService.add({severity:"warn",summary:"Invalid Form",detail:"Please check the form for errors."})}confirmImport(i){if(this.showConfirmationDialog=!1,i){let e={importerName:this.importDevicesForm.value.importer,parameters:this.importDevicesForm.value.parameters};console.log("request"),console.log(e),this.status.loading=!0,this._devicesSubscription=this._deviceService.importDevices(e).subscribe({next:()=>{this.status.loading=!1,this._messagesService.add({severity:"success",summary:"Devices Imported",detail:"The devices have been successfully imported."}),this.importDevicesForm.reset()},error:o=>{this.status.loading=!1,this.status.error=o,this._messagesService.add({severity:"error",summary:"Error importing devices",detail:o.message})}})}}ngOnDestroy(){this._importersSubscription?.unsubscribe(),this._filesSubscription?.unsubscribe(),this._devicesSubscription?.unsubscribe()}onImporterChange(i){console.log("changed"),console.log(i);let e=this.importerOptions.find(o=>o.value===i.value);console.log(e),this.selectedImporterParameters=e?.parameters||[],console.log(this.selectedImporterParameters),this._updateParameterFields()}_updateParameterFields(){let i=this.importDevicesForm.get("parameters");Object.keys(i.controls).forEach(e=>{i.removeControl(e)}),this.selectedImporterParameters.forEach(e=>{console.log("voy a poner el parametro: "+e),i.addControl(e.toString(),new Ri("",b.required))}),console.log("parameters Group Controls:",i.controls),console.log("keys parametersGroup"),console.log(Object.keys(i.controls))}closeDialog(){this.showConfirmationDialog=!1}onConfirm(){this.confirmImport(!0),this.selectedImporterParameters=[],this._updateParameterFields(),this.closeDialog()}static \u0275fac=function(e){return new(e||t)(a(N),a(y),a(Be),a(Ve),a(Oi),a(se))};static \u0275cmp=v({type:t,selectors:[["app-import-devices-form"]],inputs:{businessId:"businessId"},decls:14,vars:8,consts:[[3,"onSubmit","form"],["label","Importer","placeholder","Select importer","name","importer",3,"onChange","form","options"],[4,"ngFor","ngForOf"],[1,"mb-3"],["title","Files available for import"],["class","p-listitem",4,"ngFor","ngForOf"],["title","Import Devices","color","primary",3,"loading","disabled"],["header","Confirm Import","width","30rem",3,"visibleChange","visible"],[1,"flex","justify-content-end"],["label","Yes","severity","success",1,"mr-2",3,"click"],["label","No","severity","danger",3,"click"],["type","text",3,"label","placeholder","name","form","formField"],[1,"p-listitem"]],template:function(e,o){e&1&&(m(0,"app-form",0),h("onSubmit",function(){return o.onSubmit()}),m(1,"app-form-dropdown",1),h("onChange",function(l){return o.onImporterChange(l)}),p(),C(2,It,2,9,"div",2),m(3,"div",3)(4,"app-panel",4)(5,"ul"),C(6,Ft,2,1,"li",5),p()()(),d(7,"app-form-button",6),p(),m(8,"app-dialog",7),ci("visibleChange",function(l){return li(o.showConfirmationDialog,l)||(o.showConfirmationDialog=l),l}),h("visibleChange",function(l){return o.confirmImport(l)}),m(9,"p"),q(10,"Are you sure you want to import devices?"),p(),m(11,"div",8)(12,"app-button",9),h("click",function(){return o.onConfirm()}),p(),m(13,"app-button",10),h("click",function(){return o.closeDialog()}),p()()()),e&2&&(s("form",o.importDevicesForm),n(),s("form",o.importDevicesForm)("options",o.importerOptions),n(),s("ngForOf",o.selectedImporterParameters),n(4),s("ngForOf",o.fileOptions),n(),s("loading",o.status.loading)("disabled",o.importDevicesForm.invalid),n(),pi("visible",o.showConfirmationDialog))},dependencies:[bi,B,E,w,A,T,R,pe],encapsulation:2})};var xe=class t{constructor(i,e,o,r){this.fb=i;this._messagesService=e;this._deviceValidatorsService=o;this._businessesService=r;this.changeValidatorForm=this.fb.group({validator:["",this.validatorRequired]})}changeValidatorForm;validatorOptions=[{label:"No Validator",value:""}];_validatorsSubscription=null;_updateValidatorSubscription=null;_businessId=null;status={loading:!1,error:null};ngOnInit(){this._setBusinessId(),this.status.loading=!0,this._validatorsSubscription=this._deviceValidatorsService.getDeviceValidators().subscribe({next:i=>{this.validatorOptions=[{label:"No Validator",value:""},...i.validators.map(e=>({label:e,value:e}))],this.status.loading=!1},error:i=>{this.status.loading=!1,this.status.error=i,this._messagesService.add({severity:"error",summary:"Error loading validators",detail:i.message})}})}validatorRequired(i){return i.value===""?null:b.required(i)}onSubmit(){if(this.status.loading=!0,this.status.error=null,this.changeValidatorForm.valid&&this._businessId){let i={validator:this.changeValidatorForm.value.validator};this._updateValidatorSubscription=this._businessesService.updateValidator(this._businessId,i).subscribe({next:()=>{this.status.loading=!1;let e=this.validatorOptions.find(o=>o.value===this.changeValidatorForm.value.validator);this._messagesService.add({severity:"success",summary:"Validator Updated",detail:"The validator has been successfully updated to "+(e?e.label:"Unknown")}),this.changeValidatorForm.reset()},error:e=>{this.status.loading=!1,this.status.error=e,this._messagesService.add({severity:"error",summary:"Error updating validator",detail:e.message})}})}else this.status.loading=!1,this._messagesService.add({severity:"warn",summary:"Invalid Form",detail:"Please select a valid validator option."})}_setBusinessId(){let e=window.location.href.split("/");this._businessId=e[e.length-1]}ngOnDestroy(){this._validatorsSubscription?.unsubscribe(),this._updateValidatorSubscription?.unsubscribe()}static \u0275fac=function(e){return new(e||t)(a(N),a(y),a(J),a(z))};static \u0275cmp=v({type:t,selectors:[["app-change-validator-form"]],decls:3,vars:5,consts:[[3,"onSubmit","form"],["label","Validator","placeholder","Select Validator","name","validator",3,"form","options"],["title","Change Validator","color","primary",3,"loading","disabled"]],template:function(e,o){e&1&&(m(0,"app-form",0),h("onSubmit",function(){return o.onSubmit()}),d(1,"app-form-dropdown",1)(2,"app-form-button",2),p()),e&2&&(s("form",o.changeValidatorForm),n(),s("form",o.changeValidatorForm)("options",o.validatorOptions),n(),s("loading",o.changeValidatorForm.invalid)("disabled",o.changeValidatorForm.invalid))},dependencies:[w,T,R],encapsulation:2})};var je=class t{constructor(i,e,o,r){this._route=i;this._userService=e;this._authService=o;this._messagesService=r;this._setBusinessId()}title="Unnamed business";businesses=[];pagination={};businessId="";_userId=null;_businessesSubscription=null;_authSubscription=null;ngOnInit(){this._getUserId()}_setBusinessId(){this._route.params.subscribe(i=>{this.businessId=i.id})}_getUserId(){this._authSubscription=this._authService.userLogged.subscribe({next:i=>{i?(this._userId=i.userId,this._fetchBusinesses()):this._messagesService.add({severity:"error",summary:"Error",detail:"No user is logged in"})},error:()=>{this._messagesService.add({severity:"error",summary:"Error",detail:"Failed to fetch user information"})}})}_fetchBusinesses(i={page:1,pageSize:10}){this._userId&&(this._businessesSubscription=this._userService.getBusinesses(i,this._userId).subscribe({next:e=>{this.businesses=e.businesses.filter(o=>o.rut===this.businessId),this.businesses.length>0?this.title=this.businesses[0].name:this.title="Business not found",this.pagination=e.pagination},error:e=>{this._messagesService.add({severity:"error",summary:"Error fetching businesses",detail:e.message})}}))}onPageChange(i){this._fetchBusinesses(i)}ngOnDestroy(){this._businessesSubscription?.unsubscribe(),this._authSubscription?.unsubscribe()}static \u0275fac=function(e){return new(e||t)(a(ne),a(le),a(me),a(y))};static \u0275cmp=v({type:t,selectors:[["app-business-page"]],decls:14,vars:10,consts:[[1,"mt-2"],[1,"text-white","bg-blue-800","py-5","px-6","border-round"],[3,"icon","title"],["title","Import Devices","icon","pi-file-import",3,"toggleable","collapsed"],[3,"businessId"],[1,"flex","md:flex-row","flex-column","gap-2","my-2"],[1,"w-full"],["title","Change Validator","icon","pi-file-import",3,"toggleable","collapsed"],["label","List of Devices","icon","pi pi-lightbulb","className","w-full my-2",3,"routerLink"],["title","Create device","icon","pi-plus-circle",3,"toggleable","collapsed"]],template:function(e,o){e&1&&(m(0,"div",0)(1,"div",1),d(2,"app-icon-title",2),p(),m(3,"div",0)(4,"app-panel",3),d(5,"app-import-devices-form",4),p()(),m(6,"div",5)(7,"div",6)(8,"app-panel",7),d(9,"app-change-validator-form"),p(),d(10,"app-button",8),p(),m(11,"div",6)(12,"app-panel",9),d(13,"app-add-device-form"),p()()()()),e&2&&(n(2),s("icon","pi-building")("title",o.title),n(2),s("toggleable",!0)("collapsed",!0),n(),s("businessId",o.businessId),n(3),s("toggleable",!1)("collapsed",!1),n(2),s("routerLink","/businesses/"+o.businessId+"/devices"),n(2),s("toggleable",!1)("collapsed",!1))},dependencies:[ae,B,E,be,we,Me,xe],encapsulation:2})};var ee=class t{constructor(i,e){this._businessesService=i;this._messagesService=e}businessId;columns=[{field:"mainPhoto",header:"Photo"},{field:"secondaryPhotos",header:"Other Photos"},{field:"name",header:"Name"},{field:"businessName",header:"Business Name"},{field:"type",header:"Type"},{field:"modelNumber",header:"Model Number"}];devices=[];loading=!1;dialogVisible=!1;selectedDevice=null;pagination=null;_devicesSubscription=null;ngOnInit(){this._subscribeToDevices()}onPageChange(i){this.loading=!0,this._subscribeToDevices(j({},i))}ngOnDestroy(){this._devicesSubscription?.unsubscribe()}onRowClick(i){this.selectedDevice=i}_subscribeToDevices(i){this._devicesSubscription=this._businessesService.getDevices(this.businessId,i?j({},i):{}).subscribe({next:e=>{this.devices=e.devices,this.pagination=e.pagination,this.loading=!1},error:e=>{this.loading=!1,this._messagesService.add({severity:"error",summary:"Error",detail:e.message})}})}static \u0275fac=function(e){return new(e||t)(a(z),a(y))};static \u0275cmp=v({type:t,selectors:[["app-business-devices-table"]],inputs:{businessId:"businessId"},standalone:!0,features:[P],decls:1,vars:6,consts:[[3,"rowClick","pageChange","clickableRows","columns","devices","loading","pagination","selectedDevice"]],template:function(e,o){e&1&&(m(0,"app-base-devices-table",0),h("rowClick",function(l){return o.onRowClick(l)})("pageChange",function(l){return o.onPageChange(l)}),p()),e&2&&s("clickableRows",!0)("columns",o.columns)("devices",o.devices)("loading",o.loading)("pagination",o.pagination)("selectedDevice",o.selectedDevice)},dependencies:[k,Bi],encapsulation:2})};var Pe=class t{constructor(i){this._route=i}businessId;ngOnInit(){this._route.params.subscribe(i=>{this.businessId=i.id})}static \u0275fac=function(e){return new(e||t)(a(ne))};static \u0275cmp=v({type:t,selectors:[["app-business-devices-page"]],decls:3,vars:2,consts:[[1,"mt-2"],["title","Devices","icon","pi-desktop",3,"toggleable"],[3,"businessId"]],template:function(e,o){e&1&&(m(0,"div",0)(1,"app-panel",1),d(2,"app-business-devices-table",2),p()()),e&2&&(n(),s("toggleable",!1),n(),s("businessId",o.businessId))},dependencies:[B,ee],encapsulation:2})};var wt=[{path:"",component:he},{path:"new",component:_e},{path:":id",component:je},{path:":id/devices",component:Pe}],Ee=class t{static \u0275fac=function(e){return new(e||t)};static \u0275mod=L({type:t});static \u0275inj=G({imports:[We.forChild(wt),We]})};var Ai=class t{static \u0275fac=function(e){return new(e||t)};static \u0275mod=L({type:t});static \u0275inj=G({imports:[k,Ee,B,X,E,w,A,T,R,Z,ee,pe]})};export{Ai as BusinessesModule};
