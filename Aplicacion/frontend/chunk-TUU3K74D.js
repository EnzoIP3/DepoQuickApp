import{a as ve,b as he,d as Tt}from"./chunk-CV257ZC2.js";import{a as C,b as Ce}from"./chunk-C6OPN3MA.js";import{a as R,b as O,c as w,d as Dt}from"./chunk-SVEYEHT4.js";import{c as be,e as Mt,f as _e}from"./chunk-MQS2OHBC.js";import"./chunk-TDDMEX7Y.js";import{e as Y}from"./chunk-QQ367BQP.js";import{e as bt}from"./chunk-6ZQIWECF.js";import{a as It}from"./chunk-OQ6TPHBS.js";import{a as V}from"./chunk-SLUHDBGA.js";import"./chunk-P47V3DL4.js";import"./chunk-FFVHMX5G.js";import{a as h}from"./chunk-U64QIMIT.js";import"./chunk-XPYDWX67.js";import{b as vt,d as _,f as ht,g as _t,k as Ct,l as yt,m as E,o as St}from"./chunk-3VIG4VHP.js";import{$ as Ke,$a as de,Aa as y,Ab as lt,C as K,Ca as W,Cb as qe,Da as ot,Ea as ce,Ha as it,K as s,L as m,Ma as T,Oa as nt,Ob as ct,Pb as Ge,Qa as je,Ra as rt,S as ze,T as b,Tb as dt,U as me,Ub as ut,V as n,Xa as st,Xb as fe,Ya as mt,Yb as ge,Z as ke,Za as A,Zb as ft,_a as at,_b as gt,a as Qe,aa as a,ab as S,b as $e,ba as l,ca as c,cb as ue,da as I,ea as D,fa as ae,ga as L,ha as g,ia as f,ja as We,ka as Ye,m as Ue,n as G,na as pe,o as U,oa as ie,pa as k,q as P,qa as j,ra as N,s as d,sa as F,t as z,ta as le,ua as ne,va as Ze,wa as Je,x as H,xa as Xe,xb as pt,y as x,ya as et,za as tt,zb as B}from"./chunk-2GDBKQSI.js";var Ot=o=>({name:o});function wt(o,t){if(o&1&&F(0),o&2){let e=t.value;ne(" ",e||"-",`
`)}}var Z=class o{constructor(t,e,i){this._homesService=t;this._messagesService=e;this._router=i}columns=[{field:"address",header:"Address"},{field:"latitude",header:"Lat."},{field:"longitude",header:"Long."},{field:"maxMembers",header:"Limit of Members"},{field:"name",header:"Name"}];homes=[];_homesServiceSubscription=null;loading=!0;ngOnInit(){this._homesServiceSubscription=this._homesService.getHomes().subscribe({next:t=>{this.homes=t.homes,this.loading=!1},error:t=>{this.loading=!1,this._messagesService.add({severity:"error",summary:"Error",detail:t.message})}})}onRowClick(t){this._router.navigate(["/homes",t.id])}ngOnDestroy(){this._homesServiceSubscription?.unsubscribe()}static \u0275fac=function(e){return new(e||o)(m(C),m(h),m(B))};static \u0275cmp=d({type:o,selectors:[["app-homes-table"]],standalone:!0,features:[y],decls:3,vars:7,consts:[["nameTemplate",""],[3,"rowClick","columns","data","loading","clickableRows","customTemplates"]],template:function(e,i){if(e&1){let r=L();a(0,"app-table",1),g("rowClick",function(p){return H(r),x(i.onRowClick(p))}),l(),b(1,wt,1,1,"ng-template",null,0,T)}if(e&2){let r=N(2);n("columns",i.columns)("data",i.homes)("loading",i.loading)("clickableRows",!0)("customTemplates",W(5,Ot,r))}},dependencies:[S,be],encapsulation:2})};var ye=class o{static \u0275fac=function(e){return new(e||o)};static \u0275cmp=d({type:o,selectors:[["app-homes-page"]],decls:5,vars:0,consts:[[1,"mt-2"],["icon","pi-home","title","Homes"],[1,"mt-2","flex","justify-content-end"],["icon","pi pi-plus","label","Create home","routerLink","/homes/new"]],template:function(e,i){e&1&&(a(0,"div",0)(1,"app-panel",1),c(2,"app-homes-table"),l(),a(3,"div",2),c(4,"app-button",3),l()())},dependencies:[lt,Y,Z,V],encapsulation:2})};var X=class o{constructor(t,e,i){this._homesService=t;this._messagesService=e;this._router=i}id;onHomeNameChange=new K;loading=!0;home=null;listItems=[];_homeSubscription=null;_getHomeSubscription=null;ngOnInit(){this._getHomeSubscription=this._homesService.getHome(this.id).subscribe(),this._homeSubscription=this._homesService.home.subscribe({next:t=>{t&&(this.listItems=[{label:"Owner Name",value:`${t.owner.name} ${t.owner.surname}`},{label:"Address",value:t.address},{label:"Latitude",value:t.latitude.toString()},{label:"Longitude",value:t.longitude.toString()},{label:"Limit of Members",value:t.maxMembers.toString()}],t.name&&this.onHomeNameChange.emit(t.name),this.loading=!1)},error:t=>{this.loading=!1,this._messagesService.add({severity:"error",summary:"Error",detail:t.message}),this._router.navigate(["/homes"])}})}ngOnDestroy(){this._getHomeSubscription?.unsubscribe(),this._homeSubscription?.unsubscribe()}static \u0275fac=function(e){return new(e||o)(m(C),m(h),m(B))};static \u0275cmp=d({type:o,selectors:[["app-home-list"]],inputs:{id:"id"},outputs:{onHomeNameChange:"onHomeNameChange"},standalone:!0,features:[y],decls:1,vars:2,consts:[[3,"items","loading"]],template:function(e,i){e&1&&c(0,"app-list",0),e&2&&n("items",i.listItems)("loading",i.loading)},dependencies:[ve],encapsulation:2})};var Se=class o extends fe{constructor(t,e){super(ge.apiUrl,"members",t,e)}setNotifications(t,e){return this.patch(e,`${t}/notifications`)}static \u0275fac=function(e){return new(e||o)(P(ue),P(B))};static \u0275prov=G({token:o,factory:o.\u0275fac,providedIn:"root"})};var Ie=class o{constructor(t){this._repository=t}setNotifications(t,e){return this._repository.setNotifications(t,e)}static \u0275fac=function(e){return new(e||o)(P(Se))};static \u0275prov=G({token:o,factory:o.\u0275fac,providedIn:"root"})};function Bt(o,t){if(o&1){let e=L();I(0),a(1,"app-button",1),g("click",function(){H(e);let r=f();return x(r.setNotifications())}),l(),D()}if(o&2){let e=f();s(),n("disabled",e.loadingNotifications)}}function Et(o,t){if(o&1){let e=L();I(0),a(1,"app-button",2),g("click",function(){H(e);let r=f();return x(r.setNotifications())}),l(),D()}if(o&2){let e=f();s(),n("disabled",e.loadingNotifications)}}var De=class o{constructor(t,e){this._membersService=t;this._messagesService=e}member;loadingNotifications=!1;setNotifications(){this.loadingNotifications=!0,this._membersService.setNotifications(this.member.id,{shouldBeNotified:!this.shouldBeNotified}).subscribe({next:t=>{this._updatePermissions(t),this.loadingNotifications=!1,this._messagesService.add({severity:"success",summary:"Success",detail:`Updated notifications for ${this.member.name} ${this.member.surname}`})},error:t=>{this.loadingNotifications=!1,this._messagesService.add({severity:"error",summary:"Error",detail:t})}})}_updatePermissions(t){t.shouldBeNotified?this.member.permissions.push("get-notifications"):this.member.permissions=this.member.permissions.filter(e=>e!=="get-notifications")}get shouldBeNotified(){return this.member.permissions.includes("get-notifications")}static \u0275fac=function(e){return new(e||o)(m(Ie),m(h))};static \u0275cmp=d({type:o,selectors:[["app-set-notifications-button"]],inputs:{member:"member"},standalone:!0,features:[y],decls:2,vars:2,consts:[[4,"ngIf"],["label","Disable","severity","danger","icon","pi pi-bell-slash",3,"click","disabled"],["label","Enable","severity","info","icon","pi pi-bell",3,"click","disabled"]],template:function(e,i){e&1&&b(0,Bt,2,1,"ng-container",0)(1,Et,2,1,"ng-container",0),e&2&&(n("ngIf",i.shouldBeNotified),s(),n("ngIf",!i.shouldBeNotified))},dependencies:[S,A,V],encapsulation:2})};var kt=["photoTemplate"],jt=["nameTemplate"],qt=["boolTemplate"],Gt=["notificationTemplate"],Vt=(o,t,e,i,r,u)=>({photo:o,name:t,notifications:e,canAddDevices:i,canListDevices:r,canNameDevices:u});function Qt(o,t){if(o&1&&c(0,"app-avatar",6),o&2){let e=t.value;n("image",e)}}function $t(o,t){if(o&1&&F(0),o&2){let e=t.row;Ze(" ",e.name," ",e.surname," ")}}function Ut(o,t){if(o&1&&c(0,"app-set-notifications-button",7),o&2){let e=t.row;n("member",e)}}function zt(o,t){o&1&&c(0,"div",10)}function Kt(o,t){o&1&&c(0,"div",11)}function Wt(o,t){if(o&1&&b(0,zt,1,0,"div",8)(1,Kt,1,0,"div",9),o&2){let e=t.value;n("ngIf",e),s(),n("ngIf",!e)}}function Yt(o,t){if(o&1&&(I(0),c(1,"app-table",5),b(2,Qt,1,1,"ng-template",null,0,T)(4,$t,1,2,"ng-template",null,1,T)(6,Ut,1,1,"ng-template",null,2,T)(8,Wt,2,2,"ng-template",null,3,T),D()),o&2){let e=N(3),i=N(5),r=N(7),u=N(9),p=f();s(),n("columns",p.columns)("data",p.members)("loading",p.loading)("customTemplates",it(4,Vt,e,i,r,u,u,u))}}function Zt(o,t){if(o&1&&(I(0),a(1,"p"),F(2),l(),D()),o&2){let e=f();s(2),le(e.error)}}var ee=class o{constructor(t){this._homesService=t}photoTemplate;nameTemplate;boolTemplate;notificationTemplate;homeId;columns=[{field:"photo",header:"Photo"},{field:"name",header:"Name"},{field:"canAddDevices",header:"Can Add Devices"},{field:"canListDevices",header:"Can List Devices"},{field:"canNameDevices",header:"Can Name Devices"},{field:"notifications",header:"Notifications"}];members=[];_membersSubscription=null;_getMembersSubscription=null;error=null;loading=!0;customTemplates;ngOnInit(){this.customTemplates={},this._getMembersSubscription=this._homesService.getMembers(this.homeId).subscribe({error:()=>{this.error="You do not have permission to view members in this home.",this.loading=!1}}),this.error||(this._membersSubscription=this._homesService.members.subscribe({next:t=>{t&&(this.members=t.members.map(e=>$e(Qe({},e),{canAddDevices:this.hasPermission(e,"add-devices"),canListDevices:this.hasPermission(e,"get-devices"),canNameDevices:this.hasPermission(e,"name-device")}))),this.loading=!1}}))}ngAfterViewInit(){this.customTemplates={photo:this.photoTemplate,name:this.nameTemplate,canAddDevices:this.boolTemplate,canListDevices:this.boolTemplate,shouldBeNotified:this.notificationTemplate}}ngOnDestroy(){this._getMembersSubscription?.unsubscribe(),this._membersSubscription?.unsubscribe(),this._homesService.clearState()}hasPermission(t,e){return t.permissions.includes(e)}static \u0275fac=function(e){return new(e||o)(m(C))};static \u0275cmp=d({type:o,selectors:[["app-members-table"]],viewQuery:function(e,i){if(e&1&&(ie(kt,5),ie(jt,5),ie(qt,5),ie(Gt,5)),e&2){let r;k(r=j())&&(i.photoTemplate=r.first),k(r=j())&&(i.nameTemplate=r.first),k(r=j())&&(i.boolTemplate=r.first),k(r=j())&&(i.notificationTemplate=r.first)}},inputs:{homeId:"homeId"},standalone:!0,features:[y],decls:2,vars:2,consts:[["photoTemplate",""],["nameTemplate",""],["notificationTemplate",""],["boolTemplate",""],[4,"ngIf"],[3,"columns","data","loading","customTemplates"],[3,"image"],[3,"member"],["class","pi pi-check",4,"ngIf"],["class","pi pi-times",4,"ngIf"],[1,"pi","pi-check"],[1,"pi","pi-times"]],template:function(e,i){e&1&&b(0,Yt,10,11,"ng-container",4)(1,Zt,3,1,"ng-container",4),e&2&&(n("ngIf",!i.error),s(),n("ngIf",i.error))},dependencies:[S,A,be,Mt,De],encapsulation:2})};var Me=class o extends fe{constructor(t,e){super(ge.apiUrl,"rooms",t,e)}addDeviceToRoom(t,e){return this.post(e,`${t}/devices`)}static \u0275fac=function(e){return new(e||o)(P(ue),P(B))};static \u0275prov=G({token:o,factory:o.\u0275fac,providedIn:"root"})};var Te=class o{constructor(t){this._repository=t}addDeviceToRoom(t,e){return this._repository.addDeviceToRoom(t,e)}static \u0275fac=function(e){return new(e||o)(P(Me))};static \u0275prov=G({token:o,factory:o.\u0275fac,providedIn:"root"})};var Fe=class o{constructor(t,e,i){this._devicesService=t;this._roomsService=e;this._messagesService=i}homeId;hardwareId;roomId=null;rooms=[];loading=!0;_addDeviceToRoomSubscription=null;_moveDeviceToRoomSubscription=null;ngOnDestroy(){this._addDeviceToRoomSubscription?.unsubscribe(),this._moveDeviceToRoomSubscription?.unsubscribe()}onRoomChange(t){this.roomId?this._moveDeviceToRoom(t):this._addDeviceToRoom(t)}_moveDeviceToRoom(t){this._moveDeviceToRoomSubscription=this._devicesService.moveDeviceToRoom(this.hardwareId,{targetRoomId:t}).subscribe({next:e=>{this.roomId=e.targetRoomId,this._messagesService.add({severity:"success",summary:"Success",detail:"Moved device to room"})},error:e=>{this._messagesService.add({severity:"error",summary:"Error",detail:e.message})}})}_addDeviceToRoom(t){this._addDeviceToRoomSubscription=this._roomsService.addDeviceToRoom(t,{deviceId:this.hardwareId}).subscribe({next:e=>{this.roomId=e.roomId,this._messagesService.add({severity:"success",summary:"Success",detail:"Added device to room"})},error:e=>{this._messagesService.add({severity:"error",summary:"Error",detail:e.message})}})}static \u0275fac=function(e){return new(e||o)(m(_e),m(Te),m(h))};static \u0275cmp=d({type:o,selectors:[["app-rooms-dropdown"]],inputs:{homeId:"homeId",hardwareId:"hardwareId",roomId:"roomId",rooms:"rooms",loading:"loading"},standalone:!0,features:[y],decls:1,vars:3,consts:[["placeholder","Select Room","optionLabel","name","optionValue","id",3,"change","loading","options","value"]],template:function(e,i){e&1&&(a(0,"app-dropdown",0),g("change",function(u){return i.onRoomChange(u)}),l()),e&2&&n("loading",i.loading)("options",i.rooms)("value",i.roomId)},dependencies:[It],encapsulation:2})};var oo=["*"];function io(o,t){if(o&1&&(I(0),c(1,"app-list",1),Ye(2),D()),o&2){let e=f();s(),n("items",e.getExtraFields(e.device))}}var Re=class o{columns;device=null;getExtraFields(t){let e=p=>p.replace(/([a-z])([A-Z])/g,"$1 $2").replace(/_/g," ").toLowerCase().replace(/^./,$=>$.toUpperCase()),i=p=>p===!0?"\u2714\uFE0F":p===!1?"\u274C":p!=null?String(p):null,r=p=>this.columns.some($=>$.field===p),u=p=>p!=null;return Object.entries(t).filter(([p,$])=>!r(p)&&u($)).map(([p,$])=>({label:e(p),value:i($)})).filter(p=>p.value!==null)}static \u0275fac=function(e){return new(e||o)};static \u0275cmp=d({type:o,selectors:[["app-home-device-details"]],inputs:{columns:"columns",device:"device"},standalone:!0,features:[y],ngContentSelectors:oo,decls:1,vars:1,consts:[[4,"ngIf"],[3,"items"]],template:function(e,i){e&1&&(We(),b(0,io,3,1,"ng-container",0)),e&2&&n("ngIf",i.device)},dependencies:[ve,S,A],encapsulation:2})};var no=["nameDeviceFormTemplate"],ro=(o,t,e)=>({name:o,roomId:t,details:e}),so=o=>({$implicit:o});function mo(o,t){if(o&1&&c(0,"app-rooms-dropdown",6),o&2){let e=t.row,i=f(2);n("hardwareId",e.hardwareId)("homeId",i.homeId)("roomId",e.roomId)("rooms",i.rooms)("loading",i.loadingRooms)}}function ao(o,t){if(o&1&&F(0),o&2){let e=t.row;ne(" ",e.name||"-"," ")}}function po(o,t){o&1&&ae(0)}function lo(o,t){if(o&1&&(I(0),a(1,"app-home-device-details",7),b(2,po,1,0,"ng-container",8),l(),D()),o&2){let e=f(2);s(),n("columns",e.columns)("device",e.selectedDevice),s(),n("ngTemplateOutlet",e.nameDeviceFormTemplate)("ngTemplateOutletContext",W(4,so,e.selectedDevice))}}function co(o,t){if(o&1){let e=L();a(0,"app-button",9),g("click",function(){let r=H(e).row,u=f(2);return x(u.onRowClick(r))}),l()}}function uo(o,t){if(o&1){let e=L();I(0),c(1,"app-base-devices-table",4),b(2,mo,1,5,"ng-template",null,0,T)(4,ao,1,1,"ng-template",null,1,T),a(6,"app-dialog",5),et("visibleChange",function(r){H(e);let u=f();return Xe(u.visibleDialog,r)||(u.visibleDialog=r),x(r)}),b(7,lo,3,6,"ng-container",3),l(),b(8,co,1,0,"ng-template",null,2,T),D()}if(o&2){let e,i=N(3),r=N(5),u=N(9),p=f();s(),n("clickableRows",!1)("columns",p.columns)("devices",p.devices)("loading",p.loading)("paginate",!1)("customTemplates",ce(10,ro,r,i,u)),s(5),Je("visible",p.visibleDialog),n("closable",!0)("title",(e=p.selectedDevice==null?null:p.selectedDevice.name)!==null&&e!==void 0?e:"Unnamed device"),s(),n("ngIf",p.selectedDevice)}}function fo(o,t){if(o&1&&(I(0),F(1),D()),o&2){let e=f();s(),ne(" ",e.error,`
`)}}var te=class o{constructor(t,e){this._homesService=t;this._messagesService=e}homeId;nameDeviceFormTemplate;columns=[{field:"name",header:"Name"},{field:"mainPhoto",header:"Main Photo"},{field:"secondaryPhotos",header:"Secondary Photos"},{field:"type",header:"Type"},{field:"roomId",header:"Room"},{field:"details",header:"Details"}];devices=[];_roomsSubscription=null;_getRoomsSubscription=null;_devicesSubscription=null;_getDevicesSubscription=null;loading=!0;loadingRooms=!0;error=null;rooms=[];visibleDialog=!1;selectedDevice=null;ngOnInit(){this._getDevices(),this._getRooms()}_getRooms(){this._getRoomsSubscription=this._homesService.getRooms(this.homeId).subscribe(),this._roomsSubscription=this._homesService.rooms.subscribe({next:t=>{t&&(this.rooms=t.rooms,this.loadingRooms=!1)},error:t=>{this.loadingRooms=!1,this._messagesService.add({severity:"error",summary:"Error",detail:t.message})}})}_getDevices(){this._getDevicesSubscription=this._homesService.getDevices(this.homeId).subscribe({error:()=>{this.loading=!1,this.error="You do not have permission to view devices in this home."}}),this.error||(this._devicesSubscription=this._homesService.devices.subscribe({next:t=>{t&&(this.devices=t.devices,this._updateSelectedDevice()),this.loading=!1},error:t=>{this.loading=!1,this._messagesService.add({severity:"error",summary:"Error",detail:t.message})}}))}_updateSelectedDevice(){this.selectedDevice&&(this.selectedDevice=this.devices.find(t=>t.hardwareId===this.selectedDevice?.hardwareId)||null)}onRowClick(t){this.visibleDialog=!0,this.selectedDevice=t}ngOnDestroy(){this._getRoomsSubscription?.unsubscribe(),this._roomsSubscription?.unsubscribe(),this._getDevicesSubscription?.unsubscribe(),this._devicesSubscription?.unsubscribe()}static \u0275fac=function(e){return new(e||o)(m(C),m(h))};static \u0275cmp=d({type:o,selectors:[["app-home-devices-table"]],contentQueries:function(e,i,r){if(e&1&&pe(r,no,5),e&2){let u;k(u=j())&&(i.nameDeviceFormTemplate=u.first)}},inputs:{homeId:"homeId"},standalone:!0,features:[y],decls:2,vars:2,consts:[["roomTemplate",""],["nameTemplate",""],["detailsTemplate",""],[4,"ngIf"],[3,"clickableRows","columns","devices","loading","paginate","customTemplates"],[3,"visibleChange","visible","closable","title"],[3,"hardwareId","homeId","roomId","rooms","loading"],[3,"columns","device"],[4,"ngTemplateOutlet","ngTemplateOutletContext"],["icon","pi pi-info-circle","label","Details","severity","info",3,"click"]],template:function(e,i){e&1&&b(0,uo,10,14,"ng-container",3)(1,fo,2,1,"ng-container",3),e&2&&(n("ngIf",!i.error),s(),n("ngIf",i.error))},dependencies:[Fe,Tt,bt,S,A,de,V,Re],encapsulation:2})};var bo=(o,t,e)=>({"p-togglebutton p-button p-component":!0,"p-button-icon-only":o,"p-highlight":t,"p-disabled":e}),vo=(o,t)=>({"p-button-icon":!0,"p-button-icon-left":o,"p-button-icon-right":t}),ho=o=>({$implicit:o});function _o(o,t){if(o&1&&c(0,"span",4),o&2){let e=f(2);ke(e.checked?e.onIcon:e.offIcon),n("ngClass",ot(4,vo,e.iconPos==="left",e.iconPos==="right")),me("data-pc-section","icon")}}function Co(o,t){if(o&1&&b(0,_o,1,7,"span",3),o&2){let e=f();n("ngIf",e.onIcon||e.offIcon)}}function yo(o,t){o&1&&ae(0)}function So(o,t){if(o&1&&b(0,yo,1,0,"ng-container",5),o&2){let e=f();n("ngTemplateOutlet",e.iconTemplate)("ngTemplateOutletContext",W(2,ho,e.checked))}}function Io(o,t){if(o&1&&(a(0,"span",6),F(1),l()),o&2){let e=f();me("data-pc-section","label"),s(),le(e.checked?e.hasOnLabel?e.onLabel:"":e.hasOffLabel?e.offLabel:"")}}var Do={provide:vt,useExisting:Ue(()=>Ve),multi:!0},Ve=(()=>{class o{cd;onLabel;offLabel;onIcon;offIcon;ariaLabel;ariaLabelledBy;disabled;style;styleClass;inputId;tabindex=0;iconPos="left";autofocus;onChange=new K;templates;iconTemplate;checked=!1;onModelChange=()=>{};onModelTouched=()=>{};constructor(e){this.cd=e}ngAfterContentInit(){this.templates.forEach(e=>{switch(e.getType()){case"icon":this.iconTemplate=e.template;break;default:this.iconTemplate=e.template;break}})}toggle(e){this.disabled||(this.checked=!this.checked,this.onModelChange(this.checked),this.onModelTouched(),this.onChange.emit({originalEvent:e,checked:this.checked}),this.cd.markForCheck())}onKeyDown(e){switch(e.code){case"Enter":this.toggle(e),e.preventDefault();break;case"Space":this.toggle(e),e.preventDefault();break}}onBlur(){this.onModelTouched()}writeValue(e){this.checked=e,this.cd.markForCheck()}registerOnChange(e){this.onModelChange=e}registerOnTouched(e){this.onModelTouched=e}setDisabledState(e){this.disabled=e,this.cd.markForCheck()}get hasOnLabel(){return this.onLabel&&this.onLabel.length>0}get hasOffLabel(){return this.onLabel&&this.onLabel.length>0}static \u0275fac=function(i){return new(i||o)(m(nt))};static \u0275cmp=d({type:o,selectors:[["p-toggleButton"]],contentQueries:function(i,r,u){if(i&1&&pe(u,ct,4),i&2){let p;k(p=j())&&(r.templates=p)}},hostAttrs:[1,"p-element"],inputs:{onLabel:"onLabel",offLabel:"offLabel",onIcon:"onIcon",offIcon:"offIcon",ariaLabel:"ariaLabel",ariaLabelledBy:"ariaLabelledBy",disabled:[2,"disabled","disabled",je],style:"style",styleClass:"styleClass",inputId:"inputId",tabindex:[2,"tabindex","tabindex",rt],iconPos:"iconPos",autofocus:[2,"autofocus","autofocus",je]},outputs:{onChange:"onChange"},features:[tt([Do]),ze],decls:4,vars:17,consts:[["role","switch","pRipple","","pAutoFocus","",3,"click","keydown","ngClass","ngStyle","autofocus"],[3,"class","ngClass"],["class","p-button-label",4,"ngIf"],[3,"class","ngClass",4,"ngIf"],[3,"ngClass"],[4,"ngTemplateOutlet","ngTemplateOutletContext"],[1,"p-button-label"]],template:function(i,r){i&1&&(a(0,"div",0),g("click",function(p){return r.toggle(p)})("keydown",function(p){return r.onKeyDown(p)}),b(1,Co,1,1,"span",1)(2,So,1,4,"ng-container")(3,Io,2,2,"span",2),l()),i&2&&(ke(r.styleClass),n("ngClass",ce(13,bo,r.onIcon&&r.offIcon&&!r.hasOnLabel&&!r.hasOffLabel,r.checked,r.disabled))("ngStyle",r.style)("autofocus",r.autofocus),me("tabindex",r.disabled?null:r.tabindex)("aria-checked",r.checked)("aria-labelledby",r.ariaLabelledBy)("aria-label",r.ariaLabel)("data-pc-name","togglebutton")("data-pc-section","root"),s(),Ke(r.iconTemplate?2:1),s(2),n("ngIf",r.onLabel||r.offLabel))},dependencies:[st,A,de,at,dt,ft],styles:['@layer primeng{.p-button[_ngcontent-%COMP%]{margin:0;display:inline-flex;cursor:pointer;-webkit-user-select:none;user-select:none;align-items:center;vertical-align:bottom;text-align:center;overflow:hidden;position:relative}.p-button-label[_ngcontent-%COMP%]{flex:1 1 auto}.p-button-icon-right[_ngcontent-%COMP%]{order:1}.p-button[_ngcontent-%COMP%]:disabled{cursor:default;pointer-events:none}.p-button-icon-only[_ngcontent-%COMP%]{justify-content:center}.p-button-icon-only[_ngcontent-%COMP%]:after{content:"p";visibility:hidden;clip:rect(0 0 0 0);width:0}.p-button-vertical[_ngcontent-%COMP%]{flex-direction:column}.p-button-icon-bottom[_ngcontent-%COMP%]{order:2}.p-button-group[_ngcontent-%COMP%]   .p-button[_ngcontent-%COMP%]{margin:0}.p-button-group[_ngcontent-%COMP%]   .p-button[_ngcontent-%COMP%]:focus, .p-button-group[_ngcontent-%COMP%]   p-button[_ngcontent-%COMP%]:focus   .p-button[_ngcontent-%COMP%], .p-buttonset[_ngcontent-%COMP%]   .p-button[_ngcontent-%COMP%]:focus, .p-buttonset[_ngcontent-%COMP%]   p-button[_ngcontent-%COMP%]:focus   .p-button[_ngcontent-%COMP%]{position:relative;z-index:1}.p-button-group[_ngcontent-%COMP%]   .p-button[_ngcontent-%COMP%]:not(:last-child), .p-button-group[_ngcontent-%COMP%]   .p-button[_ngcontent-%COMP%]:not(:last-child):hover, .p-button-group[_ngcontent-%COMP%]   p-button[_ngcontent-%COMP%]:not(:last-child)   .p-button[_ngcontent-%COMP%], .p-button-group[_ngcontent-%COMP%]   p-button[_ngcontent-%COMP%]:not(:last-child)   .p-button[_ngcontent-%COMP%]:hover, .p-buttonset[_ngcontent-%COMP%]   .p-button[_ngcontent-%COMP%]:not(:last-child), .p-buttonset[_ngcontent-%COMP%]   .p-button[_ngcontent-%COMP%]:not(:last-child):hover, .p-buttonset[_ngcontent-%COMP%]   p-button[_ngcontent-%COMP%]:not(:last-child)   .p-button[_ngcontent-%COMP%], .p-buttonset[_ngcontent-%COMP%]   p-button[_ngcontent-%COMP%]:not(:last-child)   .p-button[_ngcontent-%COMP%]:hover{border-right:0 none}.p-button-group[_ngcontent-%COMP%]   .p-button[_ngcontent-%COMP%]:not(:first-of-type):not(:last-of-type), .p-button-group[_ngcontent-%COMP%]   p-button[_ngcontent-%COMP%]:not(:first-of-type):not(:last-of-type)   .p-button[_ngcontent-%COMP%], .p-buttonset[_ngcontent-%COMP%]   .p-button[_ngcontent-%COMP%]:not(:first-of-type):not(:last-of-type), .p-buttonset[_ngcontent-%COMP%]   p-button[_ngcontent-%COMP%]:not(:first-of-type):not(:last-of-type)   .p-button[_ngcontent-%COMP%]{border-radius:0}.p-button-group[_ngcontent-%COMP%]   .p-button[_ngcontent-%COMP%]:first-of-type:not(:only-of-type), .p-button-group[_ngcontent-%COMP%]   p-button[_ngcontent-%COMP%]:first-of-type:not(:only-of-type)   .p-button[_ngcontent-%COMP%], .p-buttonset[_ngcontent-%COMP%]   .p-button[_ngcontent-%COMP%]:first-of-type:not(:only-of-type), .p-buttonset[_ngcontent-%COMP%]   p-button[_ngcontent-%COMP%]:first-of-type:not(:only-of-type)   .p-button[_ngcontent-%COMP%]{border-top-right-radius:0;border-bottom-right-radius:0}.p-button-group[_ngcontent-%COMP%]   .p-button[_ngcontent-%COMP%]:last-of-type:not(:only-of-type), .p-button-group[_ngcontent-%COMP%]   p-button[_ngcontent-%COMP%]:last-of-type:not(:only-of-type)   .p-button[_ngcontent-%COMP%], .p-buttonset[_ngcontent-%COMP%]   .p-button[_ngcontent-%COMP%]:last-of-type:not(:only-of-type), .p-buttonset[_ngcontent-%COMP%]   p-button[_ngcontent-%COMP%]:last-of-type:not(:only-of-type)   .p-button[_ngcontent-%COMP%]{border-top-left-radius:0;border-bottom-left-radius:0}p-button[iconpos=right][_ngcontent-%COMP%]   spinnericon[_ngcontent-%COMP%]{order:1}}'],changeDetection:0})}return o})(),Ft=(()=>{class o{static \u0275fac=function(i){return new(i||o)};static \u0275mod=z({type:o});static \u0275inj=U({imports:[S,ut,Ge,gt,Ge]})}return o})();var oe=class o{form;name;onLabel;offLabel;onIcon;offIcon;onChange=new K;static \u0275fac=function(e){return new(e||o)};static \u0275cmp=d({type:o,selectors:[["app-form-toggle-button"]],inputs:{form:"form",name:"name",onLabel:"onLabel",offLabel:"offLabel",onIcon:"onIcon",offIcon:"offIcon"},outputs:{onChange:"onChange"},standalone:!0,features:[y],decls:2,vars:6,consts:[[1,"field",3,"formGroup"],[1,"w-full",3,"onChange","onLabel","offLabel","onIcon","offIcon","formControlName"]],template:function(e,i){e&1&&(a(0,"div",0)(1,"p-toggleButton",1),g("onChange",function(u){return i.onChange.emit(u)}),l()()),e&2&&(n("formGroup",i.form),s(),n("onLabel",i.onLabel)("offLabel",i.offLabel)("onIcon",i.onIcon)("offIcon",i.offIcon)("formControlName",i.name))},dependencies:[S,Ft,Ve,St,ht,_t,Ct,yt],encapsulation:2})};function Fo(o,t){if(o&1&&(I(0),c(1,"app-form-toggle-button",5),D()),o&2){let e=t.$implicit,i=f();s(),n("onLabel",e.label)("offLabel","Cannot "+e.label.split(" ").slice(1).join(" "))("onIcon","pi pi-check")("offIcon","pi pi-times")("form",i.permissionsGroup)("name",e.key)}}var Oe=class o{constructor(t,e,i){this._formBuilder=t;this._homesService=e;this._messagesService=i}availablePermissions=[{key:"add-devices",label:"Can Add Devices"},{key:"get-devices",label:"Can List Devices"},{key:"name-device",label:"Can Name Devices"}];formFields={email:{required:{message:"Email is required"},email:{message:"Email format is invalid"}}};ngOnInit(){let t=this.createPermissionsGroup();this.memberForm=this._formBuilder.group({email:["",[_.required,_.email]],permissions:this._formBuilder.group(t)})}createPermissionsGroup(){return this.availablePermissions.reduce((t,e)=>(t[e.key]=this._formBuilder.control(!1),t),{})}get permissionsGroup(){return this.memberForm.get("permissions")}homeId;memberForm;memberStatus={loading:!1};_addMemberSubscription=null;get permissions(){return this.memberForm.get("permissions")}isPermissionSelected(t){return this.permissions.value.includes(t)}togglePermission(t){let e=this.permissions.value.indexOf(t);e===-1?this.permissions.push(this._formBuilder.control(t)):this.permissions.removeAt(e)}onSubmit(){this.memberStatus.loading=!0;let t=this._getSelectedPermissions(this.permissionsGroup.value),e=this._buildRequest(t);this._addMemberSubscription=this._homesService.addMember(this.homeId,e).subscribe({next:()=>{this.memberStatus.loading=!1,this.memberForm.reset({email:"",permissions:{}}),this._messagesService.add({severity:"success",summary:"Success",detail:"Member added successfully"})},error:i=>{this.memberStatus.loading=!1,this._messagesService.add({severity:"error",summary:"Error",detail:i.message})}})}_buildRequest(t){return{email:this.memberForm.value.email,permissions:t}}_getSelectedPermissions(t){return Object.keys(t).filter(e=>t[e])}ngOnDestroy(){this._addMemberSubscription?.unsubscribe()}static \u0275fac=function(e){return new(e||o)(m(E),m(C),m(h))};static \u0275cmp=d({type:o,selectors:[["app-add-member-form"]],inputs:{homeId:"homeId"},decls:5,vars:6,consts:[[3,"onSubmit","form"],["type","text","label","Email","placeholder","email@example.com","name","email","iconClass","pi pi-envelope",3,"form","formField"],[1,"flex","flex-row","gap-2"],[4,"ngFor","ngForOf"],["title","Add Member","color","primary",3,"loading","disabled"],[3,"onLabel","offLabel","onIcon","offIcon","form","name"]],template:function(e,i){e&1&&(a(0,"app-form",0),g("onSubmit",function(){return i.onSubmit()}),c(1,"app-form-input",1),a(2,"div",2),b(3,Fo,2,6,"ng-container",3),l(),c(4,"app-form-button",4),l()),e&2&&(n("form",i.memberForm),s(),n("form",i.memberForm)("formField",i.formFields.email),s(2),n("ngForOf",i.availablePermissions),s(),n("loading",i.memberStatus.loading)("disabled",!i.memberForm.valid))},dependencies:[mt,w,O,oe,R],encapsulation:2})};var He=class o{constructor(t,e,i){this._formBuilder=t;this._homesService=e;this._messagesService=i}formFields={newName:{required:{message:"Name is required"}}};homeId;homeForm;homeStatus={loading:!1};_nameHomeSubscription=null;ngOnInit(){this.homeForm=this._formBuilder.group({newName:["",[_.required]]})}onSubmit(){this.homeStatus.loading=!0,this._nameHomeSubscription=this._homesService.nameHome(this.homeId,this.homeForm.value).subscribe({next:()=>{this.homeStatus.loading=!1,this._messagesService.add({severity:"success",summary:"Success",detail:`Home is now named ${this.homeForm.value.newName}`}),this.homeForm.reset({name:""})},error:t=>{this.homeStatus.loading=!1,this._messagesService.add({severity:"error",summary:"Error",detail:t.message})}})}ngOnDestroy(){this._nameHomeSubscription?.unsubscribe()}static \u0275fac=function(e){return new(e||o)(m(E),m(C),m(h))};static \u0275cmp=d({type:o,selectors:[["app-name-home-form"]],inputs:{homeId:"homeId"},decls:4,vars:5,consts:[[3,"onSubmit","form"],["type","text","label","Name","placeholder","Home Name","name","newName","iconClass","pi pi-home",3,"form","formField"],[1,"field"],["title","Name Home","color","primary",3,"loading","disabled"]],template:function(e,i){e&1&&(a(0,"app-form",0),g("onSubmit",function(){return i.onSubmit()}),c(1,"app-form-input",1)(2,"div",2)(3,"app-form-button",3),l()),e&2&&(n("form",i.homeForm),s(),n("form",i.homeForm)("formField",i.formFields.newName),s(2),n("loading",i.homeStatus.loading)("disabled",!i.homeForm.valid))},dependencies:[w,O,R],encapsulation:2})};var xe=class o{constructor(t,e,i){this._formBuilder=t;this._homesService=e;this._messagesService=i}formFields={name:{required:{message:"Name is required"}}};homeId;roomForm;roomStatus={loading:!1};_addRoomSubscription=null;ngOnInit(){this.roomForm=this._formBuilder.group({name:["",[_.required]]})}onSubmit(){this.roomStatus.loading=!0,this._addRoomSubscription=this._homesService.addRoom(this.homeId,this.roomForm.value).subscribe({next:()=>{this.roomStatus.loading=!1,this._messagesService.add({severity:"success",summary:"Success",detail:`Added '${this.roomForm.value.name}' as a room`}),this.roomForm.reset({name:""})},error:t=>{this.roomStatus.loading=!1,this._messagesService.add({severity:"error",summary:"Error",detail:t.message})}})}ngOnDestroy(){this._addRoomSubscription?.unsubscribe()}static \u0275fac=function(e){return new(e||o)(m(E),m(C),m(h))};static \u0275cmp=d({type:o,selectors:[["app-add-room-form"]],inputs:{homeId:"homeId"},decls:3,vars:5,consts:[[3,"onSubmit","form"],["type","text","label","Name","placeholder","Room Name","name","name","iconClass","pi pi-th-large",3,"form","formField"],["title","Add Room","color","primary",3,"loading","disabled"]],template:function(e,i){e&1&&(a(0,"app-form",0),g("onSubmit",function(){return i.onSubmit()}),c(1,"app-form-input",1)(2,"app-form-button",2),l()),e&2&&(n("form",i.roomForm),s(),n("form",i.roomForm)("formField",i.formFields.name),s(),n("loading",i.roomStatus.loading)("disabled",!i.roomForm.valid))},dependencies:[w,O,R],encapsulation:2})};var Le=class o{constructor(t,e,i,r){this._formBuilder=t;this._devicesService=e;this._messagesService=i;this._homesService=r}formFields={newName:{required:{message:"Name is required"}}};homeId;hardwareId;deviceForm;deviceStatus={loading:!1};_nameDeviceSubscription=null;ngOnInit(){this.deviceForm=this._formBuilder.group({newName:["",[_.required]]})}onSubmit(){this.deviceStatus.loading=!0,this._nameDeviceSubscription=this._devicesService.nameDevice(this.hardwareId,this.deviceForm.value).subscribe({next:()=>{this.deviceStatus.loading=!1,this._messagesService.add({severity:"success",summary:"Success",detail:`Device is now named ${this.deviceForm.value.newName}`}),this.deviceForm.reset({name:""}),this._homesService.getDevices(this.homeId).subscribe()},error:t=>{this.deviceStatus.loading=!1,this._messagesService.add({severity:"error",summary:"Error",detail:t.message})}})}ngOnDestroy(){this._nameDeviceSubscription?.unsubscribe()}static \u0275fac=function(e){return new(e||o)(m(E),m(_e),m(h),m(C))};static \u0275cmp=d({type:o,selectors:[["app-name-device-form"]],inputs:{homeId:"homeId",hardwareId:"hardwareId"},decls:7,vars:5,consts:[[1,"font-bold"],[3,"onSubmit","form"],["type","text","label","Name","placeholder","Device name","name","newName","iconClass","pi pi-lightbulb",3,"form","formField"],["title","Name Device","color","primary",3,"loading","disabled"]],template:function(e,i){e&1&&(c(0,"app-divider"),a(1,"p",0),F(2,"Name Device"),l(),c(3,"app-divider"),a(4,"app-form",1),g("onSubmit",function(){return i.onSubmit()}),c(5,"app-form-input",2)(6,"app-form-button",3),l()),e&2&&(s(4),n("form",i.deviceForm),s(),n("form",i.deviceForm)("formField",i.formFields.newName),s(),n("loading",i.deviceStatus.loading)("disabled",!i.deviceForm.valid))},dependencies:[w,O,R,he],encapsulation:2})};function Po(o,t){if(o&1&&c(0,"app-name-device-form",13),o&2){let e=t.$implicit,i=f();n("homeId",i.id)("hardwareId",e.hardwareId)}}var Ae=class o{constructor(t){this.route=t}title="Unnamed home";id;ngOnInit(){this.route.params.subscribe(t=>{this.id=t.id})}static \u0275fac=function(e){return new(e||o)(m(pt))};static \u0275cmp=d({type:o,selectors:[["app-home-page"]],decls:22,vars:19,consts:[["nameDeviceFormTemplate",""],[1,"mt-2"],["icon","pi-home",3,"title","toggleable"],[3,"onHomeNameChange","id"],[1,"flex","md:flex-row","mt-2","gap-2","flex-column"],[1,"flex","flex-column","gap-2","md:w-6","w-full"],["title","Add Members","icon","pi-user-plus",3,"toggleable","collapsed"],[3,"homeId"],["title","Add Device","icon","pi-plus",3,"toggleable","collapsed"],["title","Name Home","icon","pi-pencil",3,"toggleable","collapsed"],["title","Add Room","icon","pi-plus",3,"toggleable","collapsed"],["title","Members","icon","pi-users",3,"toggleable"],["title","Devices","icon","pi-lightbulb",3,"toggleable"],[3,"homeId","hardwareId"]],template:function(e,i){if(e&1){let r=L();a(0,"div",1)(1,"app-panel",2)(2,"app-home-list",3),g("onHomeNameChange",function(p){return H(r),x(i.title=p)}),l()()(),a(3,"div",4)(4,"div",5)(5,"app-panel",6),c(6,"app-add-member-form",7),l(),a(7,"app-panel",8),c(8,"app-add-device-form",7),l()(),a(9,"div",5)(10,"app-panel",9),c(11,"app-name-home-form",7),l(),a(12,"app-panel",10),c(13,"app-add-room-form",7),l()()(),a(14,"div",1)(15,"app-panel",11),c(16,"app-members-table",7),l()(),a(17,"div",1)(18,"app-panel",12)(19,"app-home-devices-table",7),b(20,Po,1,2,"ng-template",null,0,T),l()()()}e&2&&(s(),n("title",i.title)("toggleable",!1),s(),n("id",i.id),s(3),n("toggleable",!0)("collapsed",!0),s(),n("homeId",i.id),s(),n("toggleable",!0)("collapsed",!0),s(),n("homeId",i.id),s(2),n("toggleable",!0)("collapsed",!0),s(),n("homeId",i.id),s(),n("toggleable",!0)("collapsed",!0),s(),n("homeId",i.id),s(2),n("toggleable",!0),s(),n("homeId",i.id),s(2),n("toggleable",!0),s(),n("homeId",i.id))},dependencies:[Y,X,ee,Ce,te,Oe,He,xe,Le],encapsulation:2})};var Be=class o{constructor(t,e,i,r){this._formBuilder=t;this._homesService=e;this._router=i;this._messagesService=r}formFields={address:{required:{message:"Address is required"},pattern:{message:"Address must include a road and a number (e.g., A Road 123)"}},latitude:{required:{message:"Latitude is required"},min:{message:"Latitude must be between -90 and 90"},max:{message:"Latitude must be between -90 and 90"}},longitude:{required:{message:"Longitude is required"},min:{message:"Longitude must be between -90 and 90"},max:{message:"Longitude must be between -90 and 90"}},maxMembers:{required:{message:"Max. Members is required"},min:{message:"Max. Members must be at least 1"}}};homeForm;homeStatus={loading:!1,error:null};_addHomeSubscription=null;ngOnInit(){this.homeForm=this._formBuilder.group({address:["",[_.required,_.pattern(/^[A-Za-z\s]+ \d+$/)]],latitude:["",[_.required,_.min(-90),_.max(90)]],longitude:["",[_.required,_.min(-90),_.max(90)]],maxMembers:["",[_.required,_.min(1)]]})}onSubmit(){this.homeStatus.loading=!0,this.homeStatus.error=null,this._addHomeSubscription=this._homesService.addHome(this.homeForm.value).subscribe({next:()=>{this.homeStatus.loading=!1,this.homeForm.reset(),this._messagesService.add({severity:"success",summary:"Success",detail:"Home registered successfully"}),this._router.navigate(["/homes"])},error:t=>{this.homeStatus.loading=!1,this._messagesService.add({severity:"error",summary:"Error",detail:t.message})}})}ngOnDestroy(){this._addHomeSubscription&&this._addHomeSubscription.unsubscribe()}static \u0275fac=function(e){return new(e||o)(m(E),m(C),m(B),m(h))};static \u0275cmp=d({type:o,selectors:[["app-add-home-form"]],decls:8,vars:11,consts:[[1,"centered-content"],["title","Register a new home","icon","pi-home",1,"mb-4","text-primary-600","text-center"],[3,"onSubmit","form"],["type","text","label","Address","placeholder","Address","name","address","iconClass","pi pi-map-marker",3,"form","formField"],["type","number","label","Latitude","placeholder","Latitude","name","latitude","iconClass","pi pi-compass",3,"form","formField"],["type","number","label","Longitude","placeholder","Longitude","name","longitude","iconClass","pi pi-compass",3,"form","formField"],["type","number","label","Max Members","placeholder","Max Members","name","maxMembers","iconClass","pi pi-users",3,"form","formField"],["title","Register Home","color","primary",3,"loading","disabled"]],template:function(e,i){e&1&&(a(0,"div",0),c(1,"app-icon-title",1),a(2,"app-form",2),g("onSubmit",function(){return i.onSubmit()}),c(3,"app-form-input",3)(4,"app-form-input",4)(5,"app-form-input",5)(6,"app-form-input",6)(7,"app-form-button",7),l()()),e&2&&(s(2),n("form",i.homeForm),s(),n("form",i.homeForm)("formField",i.formFields.address),s(),n("form",i.homeForm)("formField",i.formFields.latitude),s(),n("form",i.homeForm)("formField",i.formFields.longitude),s(),n("form",i.homeForm)("formField",i.formFields.maxMembers),s(),n("loading",i.homeStatus.loading)("disabled",!i.homeForm.valid))},dependencies:[w,O,Dt,R],encapsulation:2})};var Ho=[{path:"",component:ye},{path:"new",component:Be},{path:":id",component:Ae}],Ee=class o{static \u0275fac=function(e){return new(e||o)};static \u0275mod=z({type:o});static \u0275inj=U({imports:[qe.forChild(Ho),qe]})};var Rt=class o{static \u0275fac=function(e){return new(e||o)};static \u0275mod=z({type:o});static \u0275inj=U({imports:[S,Ee,Y,Z,X,w,O,oe,R,ee,Ce,te,V,he]})};export{Rt as HomesModule};
