import{b as ue}from"./chunk-C6OPN3MA.js";import{a as ce,b as fe}from"./chunk-OMSTUI2X.js";import{a as y,b as A,c as F,d as V}from"./chunk-SVEYEHT4.js";import{c as le,d as de}from"./chunk-MQS2OHBC.js";import"./chunk-TDDMEX7Y.js";import{e as L}from"./chunk-QQ367BQP.js";import{a as G}from"./chunk-MJ2XE647.js";import{a as I}from"./chunk-DMCPYU7V.js";import{a as q}from"./chunk-KW7F2QVL.js";import{a as _}from"./chunk-SLUHDBGA.js";import"./chunk-P47V3DL4.js";import"./chunk-FFVHMX5G.js";import{a as v}from"./chunk-U64QIMIT.js";import"./chunk-XPYDWX67.js";import{d as p,m as k}from"./chunk-3VIG4VHP.js";import{Aa as C,Ab as pe,C as re,Cb as Z,K as n,L as o,T as te,V as t,Xb as M,Yb as N,Za as me,a as l,aa as a,ab as P,b as x,ba as m,ca as g,cb as E,da as ne,ea as oe,ga as ae,ha as d,ia as Y,j as ee,n as h,o as U,q as b,s as u,t as D,x as ie,y as se,zb as j}from"./chunk-2GDBKQSI.js";var H=class r extends M{constructor(e,i){super(N.apiUrl,"admins",e,i)}add(e){return this.post(e)}delete(e){let i=`${this.fullEndpoint}/${e}`;return this.http.delete(i,this.headers).pipe(ee(this.handleError))}static \u0275fac=function(i){return new(i||r)(b(E),b(j))};static \u0275prov=h({token:r,factory:r.\u0275fac,providedIn:"root"})};var w=class r{constructor(e){this._repository=e}addAdmin(e){return this._repository.add(e)}deleteAdmin(e){return this._repository.delete(e)}static \u0275fac=function(i){return new(i||r)(b(H))};static \u0275prov=h({token:r,factory:r.\u0275fac,providedIn:"root"})};var $=class r{constructor(e,i,s){this._formBuilder=e;this._adminsService=i;this._messagesService=s}formFields={name:{required:{message:"Name is required"}},surname:{required:{message:"Surname is required"}},email:{required:{message:"Email is required"},email:{message:"Email format is invalid"}},password:{required:{message:"Password is required"},minlength:{message:"Password must be at least 8 characters long"}}};addForm;adminStatus={loading:!1,success:!1,error:null};_addAdminSubscription=null;adminForm;ngOnInit(){this.addForm=this._formBuilder.group({name:["",[p.required]],surname:["",[p.required]],email:["",[p.required,p.email]],password:["",[p.required,p.minLength(8)]]})}onSubmit(){this.adminStatus.loading=!0,this.adminStatus.error=null,this.adminStatus.success=!1,this._addAdminSubscription=this._adminsService.addAdmin(this.addForm.value).subscribe({next:()=>{this.adminStatus.loading=!1,this.adminStatus.success=!0,this.addForm.reset(),this._messagesService.add({severity:"success",summary:"Success",detail:"Admin created successfully"})},error:e=>{this.adminStatus.loading=!1,this.adminStatus.error=e.message,this._messagesService.add({severity:"error",summary:"Error",detail:e.message})}})}ngOnDestroy(){this._addAdminSubscription?.unsubscribe()}static \u0275fac=function(i){return new(i||r)(o(k),o(w),o(v))};static \u0275cmp=u({type:r,selectors:[["app-add-admin-form"]],decls:8,vars:11,consts:[[1,"centered-content"],["title","Register a new Admin","icon","pi-user",1,"mb-4","text-primary-600","text-center"],[3,"onSubmit","form"],["type","text","label","Name","placeholder","Name","name","name","iconClass","pi pi-user",3,"form","formField"],["type","text","label","Surname","placeholder","Surname","name","surname","iconClass","pi pi-user",3,"form","formField"],["type","email","label","Email","placeholder","Email","name","email","iconClass","pi pi-envelope",3,"form","formField"],["type","password","label","Password","placeholder","Password","name","password","iconClass","pi pi-lock",3,"form","formField"],["title","Register Admin","color","primary",3,"loading","disabled"]],template:function(i,s){i&1&&(a(0,"div",0),g(1,"app-icon-title",1),a(2,"app-form",2),d("onSubmit",function(){return s.onSubmit()}),g(3,"app-form-input",3)(4,"app-form-input",4)(5,"app-form-input",5)(6,"app-form-input",6)(7,"app-form-button",7),m()()),i&2&&(n(2),t("form",s.addForm),n(),t("form",s.addForm)("formField",s.formFields.name),n(),t("form",s.addForm)("formField",s.formFields.surname),n(),t("form",s.addForm)("formField",s.formFields.email),n(),t("form",s.addForm)("formField",s.formFields.password),n(),t("loading",s.adminStatus.loading)("disabled",!s.addForm.valid))},dependencies:[y,V,A,F],encapsulation:2})};var W=class r extends M{constructor(e,i){super(N.apiUrl,"business_owners",e,i)}add(e){return this.post(e)}static \u0275fac=function(i){return new(i||r)(b(E),b(j))};static \u0275prov=h({token:r,factory:r.\u0275fac,providedIn:"root"})};var J=class r{constructor(e){this._repository=e}addBusinessOwner(e){return this._repository.add(e)}static \u0275fac=function(i){return new(i||r)(b(W))};static \u0275prov=h({token:r,factory:r.\u0275fac,providedIn:"root"})};var K=class r{constructor(e,i,s){this._formBuilder=e;this._businessOwnersService=i;this._messagesService=s}formFields={name:{required:{message:"Name is required"}},surname:{required:{message:"Surname is required"}},email:{required:{message:"Email is required"},email:{message:"Email format is invalid"}},password:{required:{message:"Password is required"},minlength:{message:"Password must be at least 8 characters long"}}};addForm;businessOwnerStatus={loading:!1,success:!1,error:null};_addBusinessOwnerSubscription=null;adminForm;ngOnInit(){this.addForm=this._formBuilder.group({name:["",[p.required]],surname:["",[p.required]],email:["",[p.required,p.email]],password:["",[p.required,p.minLength(8)]]})}onSubmit(){this.businessOwnerStatus.loading=!0,this.businessOwnerStatus.error=null,this.businessOwnerStatus.success=!1,this._addBusinessOwnerSubscription=this._businessOwnersService.addBusinessOwner(this.addForm.value).subscribe({next:()=>{this.businessOwnerStatus.loading=!1,this.businessOwnerStatus.success=!0,this.addForm.reset(),this._messagesService.add({severity:"success",summary:"Success",detail:"Business Owner created successfully"})},error:e=>{this.businessOwnerStatus.loading=!1,this.businessOwnerStatus.error=e.message,this._messagesService.add({severity:"error",summary:"Error",detail:e.message})}})}ngOnDestroy(){this._addBusinessOwnerSubscription?.unsubscribe()}static \u0275fac=function(i){return new(i||r)(o(k),o(J),o(v))};static \u0275cmp=u({type:r,selectors:[["app-add-businessowner-form"]],decls:8,vars:11,consts:[[1,"centered-content"],["title","Register a new Business Owner","icon","pi-user",1,"mb-4","text-primary-600","text-center"],[3,"onSubmit","form"],["type","text","label","Name","placeholder","Name","name","name","iconClass","pi pi-user",3,"form","formField"],["type","text","label","Surname","placeholder","Surname","name","surname","iconClass","pi pi-user",3,"form","formField"],["type","email","label","Email","placeholder","Email","name","email","iconClass","pi pi-envelope",3,"form","formField"],["type","password","label","Password","placeholder","Password","name","password","iconClass","pi pi-lock",3,"form","formField"],["title","Register Business Owner","color","primary",3,"loading","disabled"]],template:function(i,s){i&1&&(a(0,"div",0),g(1,"app-icon-title",1),a(2,"app-form",2),d("onSubmit",function(){return s.onSubmit()}),g(3,"app-form-input",3)(4,"app-form-input",4)(5,"app-form-input",5)(6,"app-form-input",6)(7,"app-form-button",7),m()()),i&2&&(n(2),t("form",s.addForm),n(),t("form",s.addForm)("formField",s.formFields.name),n(),t("form",s.addForm)("formField",s.formFields.surname),n(),t("form",s.addForm)("formField",s.formFields.email),n(),t("form",s.addForm)("formField",s.formFields.password),n(),t("loading",s.businessOwnerStatus.loading)("disabled",!s.addForm.valid))},dependencies:[y,V,A,F],encapsulation:2})};var O=class r{constructor(e,i){this._usersService=e;this._messagesService=i}columns=[{field:"fullName",header:"Full Name"},{field:"roles",header:"Role"},{field:"createdAt",header:"Created"}];filterableColumns=["fullName","roles"];_usersSubscription=null;_getUsersSubscription=null;selectedUser=null;userSelected=new re;users=[];pagination=null;filters={};loading=!0;ngOnInit(){this._subscribeToUsers()}onRowClick(e){this.selectedUser=e,this.userSelected.emit(e)}onPageChange(e){this.loading=!0,this._subscribeToUsers(l(l({},e),this.filters))}onFilterChange(e){this.filters=e,this.loading=!0,this._subscribeToUsers(l(l({},this.pagination),e))}_subscribeToUsers(e){this._getUsersSubscription=this._usersService.getUsers(e?l({},e):{}).subscribe(),this._usersSubscription=this._usersService.users.subscribe({next:i=>{i&&(this.users=i.users.map(s=>x(l({},s),{roles:s.roles.join(", "),fullName:`${s.name} ${s.surname}`})),this.pagination=i.pagination),this.loading=!1},error:i=>{this.loading=!1,this._messagesService.add({severity:"error",summary:"Error",detail:i.message})}})}ngOnDestroy(){this._usersSubscription?.unsubscribe(),this._getUsersSubscription?.unsubscribe()}static \u0275fac=function(i){return new(i||r)(o(q),o(v))};static \u0275cmp=u({type:r,selectors:[["app-users-table"]],outputs:{userSelected:"userSelected"},standalone:!0,features:[C],decls:2,vars:8,consts:[[3,"rowClick","filter","columns","data","loading","filterableColumns","clickableRows"],[3,"pageChange","currentPage","totalPages","pageSize"]],template:function(i,s){i&1&&(a(0,"app-table",0),d("rowClick",function(c){return s.onRowClick(c)})("filter",function(c){return s.onFilterChange(c)}),m(),a(1,"app-paginator",1),d("pageChange",function(c){return s.onPageChange(c)}),m()),i&2&&(t("columns",s.columns)("data",s.users)("loading",s.loading)("filterableColumns",s.filterableColumns)("clickableRows",!0),n(),t("currentPage",s.pagination==null?null:s.pagination.page)("totalPages",s.pagination==null?null:s.pagination.totalPages)("pageSize",s.pagination==null?null:s.pagination.pageSize))},dependencies:[le,de],encapsulation:2})};var B=class r{constructor(e,i){this._businessesService=e;this._messagesService=i}columns=[{field:"logo",header:"Logo"},{field:"name",header:"Business Name"},{field:"ownerName",header:"Owner Name"},{field:"ownerEmail",header:"Role"},{field:"rut",header:"RUT"}];filterableColumns=["name","ownerName"];_businessesSubscription=null;pagination=null;filters={};loading=!0;businesses=[];ngOnInit(){this._subscribeToBusinesses()}onPageChange(e){this.loading=!0,this._subscribeToBusinesses(l(l({},e),this.filters))}onFilterChange(e){this.filters=e,this._subscribeToBusinesses(l(l({},this.pagination),e))}ngOnDestroy(){this._businessesSubscription?.unsubscribe()}_subscribeToBusinesses(e){this._businessesSubscription=this._businessesService.getBusinesses(e?l({},e):{}).subscribe({next:i=>{this.businesses=i.businesses,this.pagination=i.pagination,this.loading=!1},error:i=>{this.loading=!1,this._messagesService.add({severity:"error",summary:"Error",detail:i.message})}})}static \u0275fac=function(i){return new(i||r)(o(fe),o(v))};static \u0275cmp=u({type:r,selectors:[["app-admin-businesses-table"]],standalone:!0,features:[C],decls:1,vars:5,consts:[[3,"pageChange","filterChange","businesses","columns","loading","pagination","filterableColumns"]],template:function(i,s){i&1&&(a(0,"app-base-businesses-table",0),d("pageChange",function(c){return s.onPageChange(c)})("filterChange",function(c){return s.onFilterChange(c)}),m()),i&2&&t("businesses",s.businesses)("columns",s.columns)("loading",s.loading)("pagination",s.pagination)("filterableColumns",s.filterableColumns)},dependencies:[ce],encapsulation:2})};function Te(r,e){if(r&1){let i=ae();ne(0),a(1,"app-button",1),d("click",function(){ie(i);let S=Y();return se(S.deleteAdmin())}),m(),oe()}if(r&2){let i=Y();n(),t("disabled",i.deleting)}}var R=class r{constructor(e,i,s){this._usersService=e;this._adminsService=i;this._messagesService=s}user;_deleteAdminSubscription=null;_getUsersSubscription=null;deleting=!1;deleteAdmin(){this.user&&this.user.roles.includes("Admin")?(this.deleting=!0,this._deleteAdminSubscription=this._adminsService.deleteAdmin(this.user.id).subscribe({next:()=>{this.deleting=!1,this._messagesService.add({severity:"success",summary:"Success",detail:`Admin ${this.user?.name} deleted successfully`}),this.user=null,this._getUsersSubscription=this._usersService.getUsers().subscribe()},error:e=>{this.deleting=!1,this._messagesService.add({severity:"error",summary:"Error",detail:`Failed to delete admin: ${e.message}`})}})):this._messagesService.add({severity:"warn",summary:"Warning",detail:"Please select an admin to delete"})}ngOnDestroy(){this._deleteAdminSubscription?.unsubscribe(),this._getUsersSubscription?.unsubscribe()}static \u0275fac=function(i){return new(i||r)(o(q),o(w),o(v))};static \u0275cmp=u({type:r,selectors:[["app-delete-admin-button"]],inputs:{user:"user"},standalone:!0,features:[C],decls:1,vars:1,consts:[[4,"ngIf"],["label","Delete Admin","severity","danger","icon","pi pi-minus",3,"click","disabled"]],template:function(i,s){i&1&&te(0,Te,2,1,"ng-container",0),i&2&&t("ngIf",s.user&&s.user.roles.includes("Admin"))},dependencies:[P,me,_],encapsulation:2})};var Q=class r{selectedUser=null;onUserSelected(e){this.selectedUser=e}static \u0275fac=function(i){return new(i||r)};static \u0275cmp=u({type:r,selectors:[["app-admins-page"]],decls:10,vars:1,consts:[[1,"mt-2"],["title","Users","icon","pi-user"],[3,"userSelected"],[1,"my-2","flex","flex-row","gap-3","justify-content-end"],[3,"user"],["icon","pi pi-plus","label","Add Admin","routerLink","/admins/new"],["title","Businesses","icon","pi-building"],[1,"my-2","flex","justify-content-end"],["icon","pi pi-plus","label","Add Business Owner","routerLink","/admins/business_owner/new"]],template:function(i,s){i&1&&(a(0,"div",0)(1,"app-panel",1)(2,"app-users-table",2),d("userSelected",function(c){return s.onUserSelected(c)}),m()()(),a(3,"div",3),g(4,"app-delete-admin-button",4)(5,"app-button",5),m(),a(6,"app-panel",6),g(7,"app-admin-businesses-table"),m(),a(8,"div",7),g(9,"app-button",8),m()),i&2&&(n(4),t("user",s.selectedUser))},dependencies:[pe,O,B,L,_,R],encapsulation:2})};var De=[{path:"",component:Q,canActivate:[G],data:{permissions:[I.GET_ALL_USERS,I.GET_ALL_BUSINESSES]}},{path:"new",component:$,canActivate:[G],data:{permissions:[I.CREATE_ADMINISTATOR]}},{path:"business_owner/new",component:K,canActivate:[G],data:{permissions:[I.CREATE_BUSINESS_OWNER]}}],X=class r{static \u0275fac=function(i){return new(i||r)};static \u0275mod=D({type:r});static \u0275inj=U({imports:[Z.forChild(De),Z]})};var ve=class r{static \u0275fac=function(i){return new(i||r)};static \u0275mod=D({type:r});static \u0275inj=U({imports:[P,X,O,B,y,A,F,L,_,ue,R]})};export{ve as AdminsModule};
